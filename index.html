<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Robert Winkler">
<title>Resilience4j User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Resilience4j User Guide</h1>
<div class="details">
<span id="author" class="author">Robert Winkler</span><br>
<span id="revnumber">version 0.15.0-SNAPSHOT,</span>
<span id="revdate">2019-05-18</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_getting_started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#_gradle">2.1. Gradle</a>
<ul class="sectlevel3">
<li><a href="#_release">2.1.1. Release</a></li>
<li><a href="#_snapshot">2.1.2. Snapshot</a></li>
</ul>
</li>
<li><a href="#_maven">2.2. Maven</a>
<ul class="sectlevel3">
<li><a href="#_release_2">2.2.1. Release</a></li>
<li><a href="#_snapshot_2">2.2.2. Snapshot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_usage_guide">3. Usage Guide</a>
<ul class="sectlevel2">
<li><a href="#_circuitbreaker">3.1. CircuitBreaker</a>
<ul class="sectlevel3">
<li><a href="#_introduction_2">3.1.1. Introduction</a></li>
<li><a href="#_set_up">3.1.2. Set-Up</a></li>
<li><a href="#_examples">3.1.3. Examples</a></li>
<li><a href="#_monitoring">3.1.4. Monitoring</a></li>
</ul>
</li>
<li><a href="#_ratelimiter">3.2. RateLimiter</a>
<ul class="sectlevel3">
<li><a href="#_introduction_3">3.2.1. Introduction</a></li>
<li><a href="#_examples_2">3.2.2. Examples</a></li>
<li><a href="#_monitoring_2">3.2.3. Monitoring</a></li>
</ul>
</li>
<li><a href="#_bulkhead">3.3. Bulkhead</a>
<ul class="sectlevel3">
<li><a href="#_introduction_4">3.3.1. Introduction</a></li>
<li><a href="#_set_up_2">3.3.2. Set-Up</a></li>
<li><a href="#_examples_3">3.3.3. Examples</a></li>
<li><a href="#_dynamic_bulkhead_reconfiguration">3.3.4. Dynamic bulkhead reconfiguration</a></li>
<li><a href="#_monitoring_3">3.3.5. Monitoring</a></li>
</ul>
</li>
<li><a href="#_retry">3.4. Retry</a>
<ul class="sectlevel3">
<li><a href="#_set_up_3">3.4.1. Set-Up</a></li>
<li><a href="#_examples_4">3.4.2. Examples</a></li>
</ul>
</li>
<li><a href="#_cache">3.5. Cache</a>
<ul class="sectlevel3">
<li><a href="#_set_up_4">3.5.1. Set-Up</a></li>
<li><a href="#_example">3.5.2. Example</a></li>
</ul>
</li>
<li><a href="#_timelimiter">3.6. TimeLimiter</a>
<ul class="sectlevel3">
<li><a href="#_introduction_5">3.6.1. Introduction</a></li>
<li><a href="#_examples_5">3.6.2. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_add_on_modules_usage_guide">4. Add-on modules Usage Guide</a>
<ul class="sectlevel2">
<li><a href="#_spring_boot_starter">4.1. Spring Boot Starter</a>
<ul class="sectlevel3">
<li><a href="#_gradle_2">4.1.1. Gradle</a></li>
<li><a href="#_supported_types_by_spring_boot_starter_resilience_aspects">4.1.2. Supported Types by Spring boot starter resilience aspects</a></li>
<li><a href="#_monitoring_4">4.1.3. Monitoring</a></li>
<li><a href="#_circuitbreaker_2">4.1.4. CircuitBreaker</a></li>
<li><a href="#_retry_2">4.1.5. Retry</a></li>
<li><a href="#_ratelimiter_2">4.1.6. RateLimiter</a></li>
<li><a href="#_configuration">4.1.7. Configuration</a></li>
<li><a href="#_event_monitoring">4.1.8. Event Monitoring</a></li>
</ul>
</li>
<li><a href="#_spring_boot_2_starter">4.2. Spring Boot 2 Starter</a>
<ul class="sectlevel3">
<li><a href="#_gradle_3">4.2.1. Gradle</a></li>
<li><a href="#_supported_types_by_spring_boot_starter_resilience_aspects_2">4.2.2. Supported Types by Spring boot starter resilience aspects</a></li>
<li><a href="#_monitoring_5">4.2.3. Monitoring</a></li>
<li><a href="#_circuitbreaker_5">4.2.4. CircuitBreaker</a></li>
<li><a href="#_retry_5">4.2.5. Retry</a></li>
<li><a href="#_bulkhead_2">4.2.6. Bulkhead</a></li>
<li><a href="#_ratelimiter_5">4.2.7. RateLimiter</a></li>
<li><a href="#_configuration_2">4.2.8. Configuration</a></li>
<li><a href="#_event_monitoring_2">4.2.9. Event Monitoring</a></li>
</ul>
</li>
<li><a href="#_ratpack_starter">4.3. Ratpack Starter</a>
<ul class="sectlevel3">
<li><a href="#_gradle_4">4.3.1. Gradle</a></li>
<li><a href="#_basic_usage">4.3.2. Basic Usage</a></li>
<li><a href="#_handlers">4.3.3. Handlers</a></li>
<li><a href="#_promises">4.3.4. Promises</a></li>
<li><a href="#_guice_aop">4.3.5. Guice AOP</a></li>
<li><a href="#_functional_style">4.3.6. Functional style</a></li>
<li><a href="#_adding_bulkheads_circuitbreakers_ratelimiters_and_retries">4.3.7. Adding Bulkheads, CircuitBreakers, RateLimiters, and Retries</a></li>
<li><a href="#_metrics">4.3.8. Metrics</a></li>
<li><a href="#_event_monitoring_3">4.3.9. Event Monitoring</a></li>
</ul>
</li>
<li><a href="#_retrofit">4.4. Retrofit</a>
<ul class="sectlevel3">
<li><a href="#_circuit_breaking">4.4.1. Circuit Breaking</a></li>
<li><a href="#_rate_limiting">4.4.2. Rate Limiting</a></li>
</ul>
</li>
<li><a href="#_dropwizard_metrics_exporter">4.5. Dropwizard Metrics exporter</a>
<ul class="sectlevel3">
<li><a href="#_introduction_6">4.5.1. Introduction</a></li>
<li><a href="#_usage">4.5.2. Usage</a></li>
</ul>
</li>
<li><a href="#_prometheus_metrics_integration">4.6. Prometheus Metrics Integration</a>
<ul class="sectlevel3">
<li><a href="#_introduction_7">4.6.1. Introduction</a></li>
<li><a href="#_usage_2">4.6.2. Usage</a></li>
</ul>
</li>
<li><a href="#_micrometer_metrics_exporter">4.7. Micrometer Metrics exporter</a>
<ul class="sectlevel3">
<li><a href="#_introduction_8">4.7.1. Introduction</a></li>
<li><a href="#_usage_3">4.7.2. Usage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_implementation_details">5. Implementation details</a>
<ul class="sectlevel2">
<li><a href="#_circuitbreaker_14">5.1. CircuitBreaker</a></li>
<li><a href="#_ratelimiter_14">5.2. RateLimiter</a></li>
</ul>
</li>
<li><a href="#_license">6. License</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Resilience4j is a lightweight, easy-to-use fault tolerance library inspired by <a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a>, but designed for Java 8 and functional programming. Lightweight, because the library only uses <a href="http://www.vavr.io/">Vavr (formerly Javaslang)</a>, which does not have any other external library dependencies. Netflix Hystrix, in contrast, has a compile dependency to <a href="https://github.com/Netflix/archaius">Archaius</a> which has many more external library dependencies such as Guava and Apache Commons Configuration.<br>
With Resilience4j you don&#8217;t have to go all-in, you can pick what you need.</p>
</div>
<div class="paragraph">
<p>Resilience provides several core modules and add-on modules:</p>
</div>
<div class="paragraph">
<p>Core modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resilience4j-circuitbreaker: Circuit breaking</p>
</li>
<li>
<p>resilience4j-ratelimiter: Rate limiting</p>
</li>
<li>
<p>resilience4j-bulkhead: Bulkheading</p>
</li>
<li>
<p>resilience4j-retry: Automatic retrying (sync and async)</p>
</li>
<li>
<p>resilience4j-cache: Response caching</p>
</li>
<li>
<p>resilience4j-timelimiter: Timeout handling</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add-on modules</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resilience4j-reactor: Custom Spring Reactor operator</p>
</li>
<li>
<p>resilience4j-rxjava2: Custom RxJava2 operator</p>
</li>
<li>
<p>resilience4j-micrometer: Micrometer Metrics exporter</p>
</li>
<li>
<p>resilience4j-metrics: Dropwizard Metrics exporter</p>
</li>
<li>
<p>resilience4j-prometheus: Prometheus Metrics exporter</p>
</li>
<li>
<p>resilience4j-spring-boot: Spring Boot Starter</p>
</li>
<li>
<p>resilience4j-spring-boot2: Spring Boot 2 Starter</p>
</li>
<li>
<p>resilience4j-ratpack: Ratpack Starter</p>
</li>
<li>
<p>resilience4j-retrofit: Retrofit adapter</p>
</li>
<li>
<p>resilience4j-feign: Feign adapter</p>
</li>
<li>
<p>resilience4j-vertx: Vertx Future decorator</p>
</li>
<li>
<p>resilience4j-consumer: Circular Buffer Event consumer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To highlight a few differences to Netflix Hystrix:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Hystrix calls to external systems have to be wrapped in a HystrixCommand. This library, in contrast, provides higher-order functions (decorators) to enhance any functional interface, lambda expression or method reference with a <a href="http://martinfowler.com/bliki/CircuitBreaker.html">Circuit Breaker</a>, Rate Limiter or Bulkhead. Furthermore, the library provides decorators to retry failed calls or cache call results. You can stack more than one decorator on any functional interface, lambda expression or method reference. That means, you can combine a Bulkhead, RateLimiter and Retry decorator with a CircuitBreaker decorator. The advantage is that you have the choice to select the decorator you need and nothing else. Any decorated function can be executed synchronously or asynchronously by using a CompletableFuture or RxJava.</p>
</li>
<li>
<p>Hystrix, by default, stores execution results in 10 1-second window buckets. If a 1-second window bucket is passed, a new bucket is created and the oldest is dropped. This library stores execution results in Ring Bit Buffer without a statistical rolling time window. A successful call is stored as a 0 bit and a failed call is stored as a 1 bit. The Ring Bit Buffer has a configurable fixed-size and stores the bits in a long[] array which is saving memory compared to a boolean array. That means the Ring Bit Buffer only needs an array of 16 long (64-bit) values to store the status of 1024 calls. The advantage is that this CircuitBreaker works out-of-the-box for low and high frequency backend systems, because execution results are not dropped when a time window is passed.</p>
</li>
<li>
<p>Hystrix only performs a single execution when in half-open state to determine whether to close a CircuitBreaker. This library allows to perform a configurable number of executions and compares the result against a configurable threshold to determine whether to close a CircuitBreaker.</p>
</li>
<li>
<p>This library provides custom RxJava operators to decorate any <code>Observable</code> or <code>Flowable</code> with a Circuit Breaker, Bulkhead or Ratelimiter.</p>
</li>
<li>
<p>Hystrix and this library emit a stream of events which are useful to system operators to monitor metrics about execution outcomes and latency.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a><a class="link" href="#_getting_started">2. Getting started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The projects requires JDK 8. The project is published in JCenter and Maven Central.<br>
If you use Gradle or Maven, you can include Resilience4j modules as follows.</p>
</div>
<div class="sect2">
<h3 id="_gradle"><a class="anchor" href="#_gradle"></a><a class="link" href="#_gradle">2.1. Gradle</a></h3>
<div class="sect3">
<h4 id="_release"><a class="anchor" href="#_release"></a><a class="link" href="#_release">2.1.1. Release</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    jCenter()
}

compile "io.github.resilience4j:resilience4j-circuitbreaker:0.14.1"
compile "io.github.resilience4j:resilience4j-ratelimiter:0.14.1"
compile "io.github.resilience4j:resilience4j-retry:0.14.1"
compile "io.github.resilience4j:resilience4j-bulkhead:0.14.1"
compile "io.github.resilience4j:resilience4j-cache:0.14.1"
compile "io.github.resilience4j:resilience4j-timelimiter:0.14.1"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snapshot"><a class="anchor" href="#_snapshot"></a><a class="link" href="#_snapshot">2.1.2. Snapshot</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
   maven { url <span class="string"><span class="delimiter">'</span><span class="content">http://oss.jfrog.org/artifactory/oss-snapshot-local/</span><span class="delimiter">'</span></span> }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven"><a class="anchor" href="#_maven"></a><a class="link" href="#_maven">2.2. Maven</a></h3>
<div class="sect3">
<h4 id="_release_2"><a class="anchor" href="#_release_2"></a><a class="link" href="#_release_2">2.2.1. Release</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repositories&gt;</span>
    <span class="tag">&lt;repository&gt;</span>
        <span class="tag">&lt;snapshots&gt;</span>
            <span class="tag">&lt;enabled&gt;</span>false<span class="tag">&lt;/enabled&gt;</span>
        <span class="tag">&lt;/snapshots&gt;</span>
        <span class="tag">&lt;id&gt;</span>jcenter-releases<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;name&gt;</span>jcenter<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;url&gt;</span>http://jcenter.bintray.com<span class="tag">&lt;/url&gt;</span>
    <span class="tag">&lt;/repository&gt;</span>
<span class="tag">&lt;/repositories&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.github.resilience4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>resilience4j-circuitbreaker<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.14.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.github.resilience4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>resilience4j-ratelimiter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.14.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.github.resilience4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>resilience4j-retry<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.14.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.github.resilience4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>resilience4j-bulkhead<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.14.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.github.resilience4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>resilience4j-cache<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.14.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.github.resilience4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>resilience4j-timelimiter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.14.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snapshot_2"><a class="anchor" href="#_snapshot_2"></a><a class="link" href="#_snapshot_2">2.2.2. Snapshot</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;jcenter-snapshots&lt;/id&gt;
      &lt;name&gt;jcenter&lt;/name&gt;
      &lt;url&gt;http:<span class="comment">//oss.jfrog.org/artifactory/oss-snapshot-local/&lt;/url&gt;</span>
    &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage_guide"><a class="anchor" href="#_usage_guide"></a><a class="link" href="#_usage_guide">3. Usage Guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Resilience provides several core modules:</p>
</div>
<div class="paragraph">
<p>Core modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resilience4j-circuitbreaker: Circuit breaking</p>
</li>
<li>
<p>resilience4j-ratelimiter: Rate limiting</p>
</li>
<li>
<p>resilience4j-bulkhead: Bulkheading</p>
</li>
<li>
<p>resilience4j-retry: Automatic retrying</p>
</li>
<li>
<p>resilience4j-cache: Response caching</p>
</li>
<li>
<p>resilience4j-timelimiter: Timeout handling</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_circuitbreaker"><a class="anchor" href="#_circuitbreaker"></a><a class="link" href="#_circuitbreaker">3.1. CircuitBreaker</a></h3>
<div class="sect3">
<h4 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a><a class="link" href="#_introduction_2">3.1.1. Introduction</a></h4>
<div class="paragraph">
<p>Resilience4j comes with an in-memory <code>CircuitBreakerRegistry</code> based on a <code>ConcurrentHashMap</code> which provides thread safety and atomicity guarantees. You can use the CircuitBreakerRegistry to manage (create and retrieve) CircuitBreaker instances. You can create a CircuitBreakerRegistry with a default global <code>CircuitBreakerConfig</code> for all of your CircuitBreaker instances as follows.</p>
</div>
</div>
<div class="sect3">
<h4 id="_set_up"><a class="anchor" href="#_set_up"></a><a class="link" href="#_set_up">3.1.2. Set-Up</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreakerRegistry circuitBreakerRegistry = CircuitBreakerRegistry.ofDefaults();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative you can provide your own custom global <code>CircuitBreakerConfig</code>. In order to create a custom global CircuitBreakerConfig or a CircuitBreakerConfig for a specific CircuitBreaker, you can use the CircuitBreakerConfig builder. You can configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the failure rate threshold in percentage above which the CircuitBreaker should trip open and start short-circuiting calls</p>
</li>
<li>
<p>the wait duration which specifies how long the CircuitBreaker should stay open, before it switches to half open</p>
</li>
<li>
<p>the size of the ring buffer when the CircuitBreaker is half open</p>
</li>
<li>
<p>the size of the ring buffer when the CircuitBreaker is closed</p>
</li>
<li>
<p>a custom CircuitBreakerEventListener which handles CircuitBreaker events</p>
</li>
<li>
<p>a custom Predicate which evaluates if an exception should be recorded as a failure and thus increase the failure rate</p>
</li>
<li>
<p>a list of exceptions which should increase failure count</p>
</li>
<li>
<p>a list of exceptions which should be ignored and not increase failure count</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a custom configuration for a CircuitBreaker</span>
CircuitBreakerConfig circuitBreakerConfig = CircuitBreakerConfig.custom()
    .failureRateThreshold(<span class="integer">50</span>)
    .waitDurationInOpenState(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">1000</span>))
    .ringBufferSizeInHalfOpenState(<span class="integer">2</span>)
    .ringBufferSizeInClosedState(<span class="integer">2</span>)
    .recordExceptions(<span class="exception">IOException</span>.class, <span class="exception">TimeoutException</span>.class)
    .ignoreExceptions(BusinessException.class, OtherBusinessException.class)
    .build();

<span class="comment">// Create a CircuitBreakerRegistry with a custom global configuration</span>
CircuitBreakerRegistry circuitBreakerRegistry = CircuitBreakerRegistry.of(circuitBreakerConfig);

<span class="comment">// Get a CircuitBreaker from the CircuitBreakerRegistry with the global default configuration</span>
CircuitBreaker circuitBreaker2 = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">otherName</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Get a CircuitBreaker from the CircuitBreakerRegistry with a custom configuration</span>
CircuitBreaker circuitBreaker = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">uniqueName</span><span class="delimiter">&quot;</span></span>, circuitBreakerConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can register event consumer on a CircuitBreakerRegistry and take actions whenever a CircuitBreaker is created, replaced or deleted.<br>
For example, you can register a global event consumer to every newly created CircuitBreaker as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CircuitBreakerRegistry circuitBreakerRegistry = CircuitBreakerRegistry.ofDefaults();
    circuitBreakerRegistry.getEventPublisher()
        .onEntryAdded(entryAddedEvent -&gt; {
            CircuitBreaker addedCircuitBreaker =  entryAddedEvent.getAddedEntry();
            LOG.info("CircuitBreaker {} added", addedCircuitBreaker.getName());
            addedCircuitBreaker.getEventPublisher().onEvent(circuitBreakerEvent -&gt; LOG.info(circuitBreakerEvent.toString()));
        })
        .onEntryRemoved(entryRemovedEvent -&gt; {
            CircuitBreaker removedCircuitBreaker =  entryRemovedEvent.getRemovedEntry();
            LOG.info("CircuitBreaker {} removed", removedCircuitBreaker.getName());
        });</pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use the CircuitBreakerRegistry to manage CircuitBreaker instances, you can also create instances directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker defaultCircuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);

CircuitBreaker customCircuitBreaker = CircuitBreaker.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>, circuitBreakerConfig);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">3.1.3. Examples</a></h4>
<div class="paragraph">
<p>You can decorate any <code>Supplier / Runnable / Function</code> or <code>CheckedRunnable / CheckedFunction</code> function with <code>CircuitBreaker.decorateCheckedSupplier()</code>, <code>CircuitBreaker.decorateCheckedRunnable()</code> or <code>CircuitBreaker.decorateCheckedFunction()</code>.<br>
You can invoke the decorated function with <code>Try.of(&#8230;&#8203;)</code> or <code>Try.run(&#8230;&#8203;)</code> from <a href="http://www.vavr.io/">Vavr</a>. This allows to chain further functions with <code>map</code>, <code>flatMap</code>, <code>filter</code>, <code>recover</code> or <code>andThen</code>. The chained functions are only invoked, if the CircuitBreaker is CLOSED or HALF_OPEN.<br>
In the following example, <code>Try.of(&#8230;&#8203;)</code> returns a <code>Success&lt;String&gt;</code> Monad, if the invocation of the function is successful. If the function throws an exception, a <code>Failure&lt;Throwable&gt;</code> Monad is returned and <code>map</code> is not invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// When I decorate my function</span>
CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; decoratedSupplier = CircuitBreaker
        .decorateCheckedSupplier(circuitBreaker, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">This can be any method which returns: 'Hello</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// and chain an other function with map</span>
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(decoratedSupplier)
                .map(value -&gt; value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> world'</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Then the Try Monad returns a Success&lt;String&gt;, if all functions ran successfully.</span>
assertThat(result.isSuccess()).isTrue();
assertThat(result.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This can be any method which returns: 'Hello world'</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also chain up functions which are decorated by different CircuitBreakers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);
CircuitBreaker anotherCircuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherTestName</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// When I create a Supplier and a Function which are decorated by different CircuitBreakers</span>
CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; decoratedSupplier = CircuitBreaker
        .decorateCheckedSupplier(circuitBreaker, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);

CheckedFunction1&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; decoratedFunction = CircuitBreaker
        .decorateCheckedFunction(anotherCircuitBreaker, (input) -&gt; input + <span class="string"><span class="delimiter">&quot;</span><span class="content"> world</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// and I chain a function with map</span>
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(decoratedSupplier)
        .mapTry(decoratedFunction::apply);

<span class="comment">// Then</span>
assertThat(result.isSuccess()).isTrue();
assertThat(result.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_and_rxjava"><a class="anchor" href="#_circuitbreaker_and_rxjava"></a><a class="link" href="#_circuitbreaker_and_rxjava">CircuitBreaker and RxJava</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate an Observable by using the custom RxJava operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Observable</span>.fromCallable(backendService::doSomething)
    .compose(CircuitBreakerOperator.of(circuitBreaker))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other reactive types (Flowable, Single, Maybe and Completable) are also supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_and_reactor"><a class="anchor" href="#_circuitbreaker_and_reactor"></a><a class="link" href="#_circuitbreaker_and_reactor">CircuitBreaker and Reactor</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate a Mono by using the custom Reactor operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
Mono.fromCallable(backendService::doSomething)
    .compose(CircuitBreakerOperator.of(circuitBreaker))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Flux is also supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_open_circuitbreaker_example"><a class="anchor" href="#_open_circuitbreaker_example"></a><a class="link" href="#_open_circuitbreaker_example">OPEN CircuitBreaker example</a></h5>
<div class="paragraph">
<p>In this example <code>map</code> is not invoked, because the CircuitBreaker is OPEN. The call to <code>Try.of</code> returns a <code>Failure&lt;Throwable&gt;</code> Monad so that the chained function is not invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
CircuitBreakerConfig circuitBreakerConfig = CircuitBreakerConfig.custom()
        .ringBufferSizeInClosedState(<span class="integer">2</span>)
        .waitDurationInOpenState(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">1000</span>))
        .build();
CircuitBreaker circuitBreaker = CircuitBreaker.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>, circuitBreakerConfig);

<span class="comment">// Simulate a failure attempt</span>
circuitBreaker.onError(<span class="integer">0</span>, <span class="keyword">new</span> <span class="exception">RuntimeException</span>());
<span class="comment">// CircuitBreaker is still CLOSED, because 1 failure is allowed</span>
assertThat(circuitBreaker.getState()).isEqualTo(CircuitBreaker.State.CLOSED);
<span class="comment">// Simulate a failure attempt</span>
circuitBreaker.onError(<span class="integer">0</span>, <span class="keyword">new</span> <span class="exception">RuntimeException</span>());
<span class="comment">// CircuitBreaker is OPEN, because the failure rate is above 50%</span>
assertThat(circuitBreaker.getState()).isEqualTo(CircuitBreaker.State.OPEN);

<span class="comment">// When I decorate my function and invoke the decorated function</span>
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(CircuitBreaker.decorateCheckedSupplier(circuitBreaker, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>))
        .map(value -&gt; value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> world</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Then the call fails, because CircuitBreaker is OPEN</span>
assertThat(result.isFailure()).isTrue();
<span class="comment">// Exception is CircuitBreakerOpenException</span>
assertThat(result.failed().get()).isInstanceOf(CircuitBreakerOpenException.class);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reset"><a class="anchor" href="#_reset"></a><a class="link" href="#_reset">Reset</a></h5>
<div class="paragraph">
<p>The CircuitBreaker supports resetting, returning to its original state while losing all the current metrics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">circuitBreaker.reset();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_recover_from_an_exception_before_call"><a class="anchor" href="#_recover_from_an_exception_before_call"></a><a class="link" href="#_recover_from_an_exception_before_call">Recover from an exception before call</a></h5>
<div class="paragraph">
<p>If you want to recover from an exception before the CircuitBreaker records it as a failure, you can do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;<span class="predefined-type">String</span>&gt; supplier = () -&gt; {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAM!</span><span class="delimiter">&quot;</span></span>);
        };
Supplier&lt;<span class="predefined-type">String</span>&gt; supplierWithRecovery = SupplierUtils.recover(supplier, (exception) -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Recovery</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> result = circuitBreaker.executeSupplier(supplierWithRecovery);
assertThat(result).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Recovery</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SupplierUtils</code> and <code>CallableUtils</code> contain other methods like <code>andThen</code> which can take can be used to chain functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;<span class="predefined-type">String</span>&gt; supplierWithResultAndExceptionHandler = SupplierUtils.andThen(supplier, (result, exception) -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Recovery</span><span class="delimiter">&quot;</span></span>);

Supplier&lt;HttpResponse&gt; supplier = () -&gt; httpClient.doRemoteCall();
Supplier&lt;<span class="predefined-type">String</span>&gt; supplierWithResultHandling = SupplierUtils.andThen(supplier, result -&gt; {
    <span class="keyword">if</span> (result.getStatusCode() == <span class="integer">400</span>) {
       <span class="keyword">throw</span> <span class="keyword">new</span> ClientException();
    } <span class="keyword">else</span> <span class="keyword">if</span> (result.getStatusCode() == <span class="integer">500</span>) {
       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">ServerException</span>();
    });
HttpResponse httpResponse = circuitBreaker.executeSupplier(supplierWithResultHandling);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_recover_from_an_exception_after_call"><a class="anchor" href="#_recover_from_an_exception_after_call"></a><a class="link" href="#_recover_from_an_exception_after_call">Recover from an exception after call</a></h5>
<div class="paragraph">
<p>If you want to recover from an exception after the CircuitBreaker recorded it as a failure, you can chain the method <code>Try.recover()</code>. The recovery method is only invoked, if <code>Try.of()</code> returns a <code>Failure&lt;Throwable&gt;</code> Monad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// When I decorate my function and invoke the decorated function</span>
CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; checkedSupplier = CircuitBreaker.decorateCheckedSupplier(circuitBreaker, () -&gt; {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAM!</span><span class="delimiter">&quot;</span></span>);
});
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(checkedSupplier)
        .recover(throwable -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Recovery</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Then the function should be a success, because the exception could be recovered</span>
assertThat(result.isSuccess()).isTrue();
<span class="comment">// and the result must match the result of the recovery function.</span>
assertThat(result.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Recovery</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customize_the_exception_handler"><a class="anchor" href="#_customize_the_exception_handler"></a><a class="link" href="#_customize_the_exception_handler">Customize the exception handler</a></h5>
<div class="paragraph">
<p>The default exception predicate counts all type of exceptions as failures and triggers the CircuitBreaker. If you want to use a custom exception predicate, you have to implement the functional interface <code>Predicate</code> which has a method <code>test</code>. The Predicate must return true if the exception should count as a failure, otherwise it must return false.<br>
The following example shows how to ignore an <code>IOException</code>, but all other exception types still count as failures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
CircuitBreakerConfig circuitBreakerConfig = CircuitBreakerConfig.custom()
        .ringBufferSizeInClosedState(<span class="integer">2</span>)
        .ringBufferSizeInHalfOpenState(<span class="integer">2</span>)
        .waitDurationInOpenState(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">1000</span>))
        .recordFailure(throwable -&gt; Match(throwable).of(
                Case(<span class="error">$</span>(instanceOf(WebServiceException.class)), <span class="predefined-constant">true</span>),
                Case(<span class="error">$</span>(), <span class="predefined-constant">false</span>)))
        .build();
CircuitBreaker circuitBreaker = CircuitBreaker.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>, circuitBreakerConfig);

<span class="comment">// Simulate a failure attempt</span>
circuitBreaker.onError(<span class="integer">0</span>, <span class="keyword">new</span> WebServiceException());
<span class="comment">// CircuitBreaker is still CLOSED, because 1 failure is allowed</span>
assertThat(circuitBreaker.getState()).isEqualTo(CircuitBreaker.State.CLOSED);

<span class="comment">//When</span>
CheckedRunnable checkedRunnable = CircuitBreaker.decorateCheckedRunnable(circuitBreaker, () -&gt; {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SocketTimeoutException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAM!</span><span class="delimiter">&quot;</span></span>);
});
Try result = Try.run(checkedRunnable);

<span class="comment">//Then</span>
assertThat(result.isFailure()).isTrue();
<span class="comment">// CircuitBreaker is still CLOSED, because SocketTimeoutException has not been recorded as a failure</span>
assertThat(circuitBreaker.getState()).isEqualTo(CircuitBreaker.State.CLOSED);
assertThat(result.failed().get()).isInstanceOf(<span class="exception">IOException</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_consume_emitted_circuitbreakerevents"><a class="anchor" href="#_consume_emitted_circuitbreakerevents"></a><a class="link" href="#_consume_emitted_circuitbreakerevents">Consume emitted CircuitBreakerEvents</a></h5>
<div class="paragraph">
<p>A <code>CircuitBreakerEvent</code> can be a state transition, a circuit breaker reset, a successful call, a recorded error or an ignored error. All events contains additional information like event creation time and processing duration of the call. If you want to consume events, you have to register an event consumer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">circuitBreaker.getEventPublisher()
    .onSuccess(event -&gt; logger.info(...))
    .onError(event -&gt; logger.info(...))
    .onIgnoredError(event -&gt; logger.info(...))
    .onReset(event -&gt; logger.info(...))
    .onStateTransition(event -&gt; logger.info(...));
<span class="comment">// Or if you want to register a consumer listening to all events, you can do:</span>
circuitBreaker.getEventPublisher()
    .onEvent(event -&gt; logger.info(...));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could use the <code>CircularEventConsumer</code> to store events in a circular buffer with a fixed capacity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircularEventConsumer&lt;CircuitBreakerEvent&gt; ringBuffer = <span class="keyword">new</span> CircularEventConsumer&lt;&gt;(<span class="integer">10</span>);
circuitBreaker.getEventPublisher().onEvent(ringBuffer);
<span class="predefined-type">List</span>&lt;CircuitBreakerEvent&gt; bufferedEvents = ringBuffer.getBufferedEvents()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use RxJava or Spring Reactor Adapters to convert the <code>EventPublisher</code> into a Reactive Stream. The advantage of a Reactive Stream is that you can use RxJava&#8217;s <code>observeOn</code> operator to specify a different Scheduler that the CircuitBreaker will use to send notifications to its observers/consumers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RxJava2Adapter.toFlowable(circuitBreaker.getEventPublisher())
    .filter(event -&gt; event.getEventType() == <span class="predefined-type">Type</span>.ERROR)
    .cast(CircuitBreakerOnErrorEvent.class)
    .subscribe(event -&gt; logger.info(...))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring"><a class="anchor" href="#_monitoring"></a><a class="link" href="#_monitoring">3.1.4. Monitoring</a></h4>
<div class="paragraph">
<p>The CircuitBreaker provides an interface to monitor the current metrics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker.Metrics metrics = circuitBreaker.getMetrics();
<span class="comment">// Returns the current failure rate in percentage.</span>
<span class="type">float</span> failureRate = metrics.getFailureRate();
<span class="comment">// Returns the current number of buffered calls.</span>
<span class="type">int</span> bufferedCalls = metrics.getNumberOfBufferedCalls();
<span class="comment">// Returns the current number of failed calls.</span>
<span class="type">int</span> failedCalls = metrics.getNumberOfFailedCalls();
<span class="comment">// Returns the current number of not permitted calls when the CircuitBreaker is open.</span>
<span class="type">int</span> failedCalls = metrics.getNumberOfNotPermittedCalls();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ratelimiter"><a class="anchor" href="#_ratelimiter"></a><a class="link" href="#_ratelimiter">3.2. RateLimiter</a></h3>
<div class="sect3">
<h4 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a><a class="link" href="#_introduction_3">3.2.1. Introduction</a></h4>
<div class="paragraph">
<p>The RateLimiter API is very similar to CircuitBreaker.<br>
So it also have in-memory RateLimiterRegistry and RateLimiterConfig where you can configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the period of limit refresh, after each period rate limiter sets its permissions count to <code>limitForPeriod</code> value.</p>
</li>
<li>
<p>the permissions limit for refresh period.</p>
</li>
<li>
<p>the default wait for permission duration.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_examples_2"><a class="anchor" href="#_examples_2"></a><a class="link" href="#_examples_2">3.2.2. Examples</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// For example you want to restrict the calling rate of some method to be not higher than 10 req/ms.</span>
RateLimiterConfig config = RateLimiterConfig.custom()
    .limitRefreshPeriod(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">1</span>))
    .limitForPeriod(<span class="integer">10</span>)
    .timeoutDuration(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">25</span>))
    .build();

<span class="comment">// Create registry</span>
RateLimiterRegistry rateLimiterRegistry = RateLimiterRegistry.of(config);

<span class="comment">// Use registry</span>
RateLimiter rateLimiterWithDefaultConfig = rateLimiterRegistry.rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">backend</span><span class="delimiter">&quot;</span></span>);
RateLimiter rateLimiterWithCustomConfig = rateLimiterRegistry.rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">backend#2</span><span class="delimiter">&quot;</span></span>, config);

<span class="comment">// Or create RateLimiter directly</span>
RateLimiter rateLimiter = RateLimiter.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">NASDAQ :-)</span><span class="delimiter">&quot;</span></span>, config);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_use_a_ratelimiter"><a class="anchor" href="#_use_a_ratelimiter"></a><a class="link" href="#_use_a_ratelimiter">Use a RateLimiter</a></h5>
<div class="paragraph">
<p>As you can guess RateLimiter has all sort of higher order decorator functions just like CircuitBreaker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Decorate your call to BackendService.doSomething()</span>
CheckedRunnable restrictedCall = RateLimiter
    .decorateCheckedRunnable(rateLimiter, backendService::doSomething);

Try.run(restrictedCall)
    .andThenTry(restrictedCall)
    .onFailure((RequestNotPermitted throwable) -&gt; LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wait before call it again :)</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dynamic_rate_limiter_reconfiguration"><a class="anchor" href="#_dynamic_rate_limiter_reconfiguration"></a><a class="link" href="#_dynamic_rate_limiter_reconfiguration">Dynamic rate limiter reconfiguration</a></h5>
<div class="paragraph">
<p>You can use <code>changeTimeoutDuration</code> and <code>changeLimitForPeriod</code> methods to change rate limiter params in runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Decorate your call to BackendService.doSomething()</span>
CheckedRunnable restrictedCall = RateLimiter
    .decorateCheckedRunnable(rateLimiter, backendService::doSomething);

Try.run(restrictedCall)
    .andThenTry(restrictedCall)
    .onFailure((RequestNotPermitted throwable) -&gt; LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wait before call it again :)</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// durring second refresh cycle limiter will get 100 permissions</span>
rateLimiter.changeLimitForPeriod(<span class="integer">100</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>New timeout duration won&#8217;t affect threads that are currently waiting for permission.<br>
New limit won&#8217;t affect current period permissions and will apply only from next one.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_and_rxjava"><a class="anchor" href="#_ratelimiter_and_rxjava"></a><a class="link" href="#_ratelimiter_and_rxjava">RateLimiter and RxJava</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate an Observable by using the custom RxJava operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RateLimiter rateLimiter = RateLimiter.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Observable</span>.fromCallable(backendService::doSomething)
    .compose(RateLimiterOperator.of(rateLimiter))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other reactive types (Flowable, Single, Maybe and Completable) are also supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_and_reactor"><a class="anchor" href="#_ratelimiter_and_reactor"></a><a class="link" href="#_ratelimiter_and_reactor">RateLimiter and Reactor</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate a Mono by using the custom Reactor operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RateLimiter rateLimiter = RateLimiter.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
Mono.fromCallable(backendService::doSomething)
    .compose(RateLimiterOperator.of(rateLimiter))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Flux is also supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_consume_emitted_ratelimiterevents"><a class="anchor" href="#_consume_emitted_ratelimiterevents"></a><a class="link" href="#_consume_emitted_ratelimiterevents">Consume emitted RateLimiterEvents</a></h5>
<div class="paragraph">
<p>The RateLimiter emits a stream of RateLimiterEvents. An event can be a successful permission acquire or acquire failure.<br>
All events contains additional information like event creation time and rate limiter name.<br>
If you want to consume events, you have to register an event consumer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">rateLimiter.getEventPublisher()
    .onSuccess(event -&gt; logger.info(...))
    .onFailure(event -&gt; logger.info(...));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use RxJava or Spring Reactor Adapters to convert the <code>EventPublisher</code> into a Reactive Stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RxJava2Adapter.toFlowable(rateLimiter.getEventPublisher())
    .filter(event -&gt; event.getEventType() == FAILED_ACQUIRE)
    .subscribe(event -&gt; logger.info(...))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_2"><a class="anchor" href="#_monitoring_2"></a><a class="link" href="#_monitoring_2">3.2.3. Monitoring</a></h4>
<div class="paragraph">
<p>The RateLimiter provides simple an interface to monitor the current limiter.<br>
Also AtomicRateLimiter has some enhanced Metrics with some implementation specific details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RateLimiter limit;
RateLimiter.Metrics metrics = limit.getMetrics();
<span class="type">int</span> numberOfThreadsWaitingForPermission = metrics.getNumberOfWaitingThreads();
<span class="comment">// Estimates count of available permissions. Can be negative if some permissions where reserved.</span>
<span class="type">int</span> availablePermissions = metrics.getAvailablePermissions();

AtomicRateLimiter atomicLimiter;
<span class="comment">// Estimated time duration in nanos to wait for the next permission</span>
<span class="type">long</span> nanosToWaitForPermission = atomicLimiter.getNanosToWait();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_low_level_api"><a class="anchor" href="#_low_level_api"></a><a class="link" href="#_low_level_api">Low level API</a></h5>
<div class="paragraph">
<p>If you&#8217;re interested in making your own thing on top of Resilience4j RateLimiter you&#8217;ll possibly be interested in<br>
our lower level APIs like <code>getPermission</code> and <code>reservePermission</code> methods.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bulkhead"><a class="anchor" href="#_bulkhead"></a><a class="link" href="#_bulkhead">3.3. Bulkhead</a></h3>
<div class="sect3">
<h4 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a><a class="link" href="#_introduction_4">3.3.1. Introduction</a></h4>
<div class="paragraph">
<p>Provides an implementation of a bulkhead pattern that can be used to limit the amount of parallel executions - in case of backend calls to downstream dependencies, the bulkhead provides dependency isolation and load shedding. For cpu-bound work, the bulkhead provides load shedding only.</p>
</div>
<div class="paragraph">
<p>This bulkhead abstraction should work well across a variety of threading and io models. It is based on a semaphore, and unlike Hystrix, does not provide "shadow" thread pool option. It is up to the client to ensure correct thread pool sizing that will be consistent with bulkhead configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_set_up_2"><a class="anchor" href="#_set_up_2"></a><a class="link" href="#_set_up_2">3.3.2. Set-Up</a></h4>
<div class="paragraph">
<p>Just like the CircuitBreaker, this module provides in-memory 'BulkheadRegistry'. You can use the registry to manage (create and retrieve) Bulkhead instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BulkheadRegistry bulkheadRegistry = BulkheadRegistry.ofDefaults();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative you can provide custom global <code>BulkheadConfig</code>. In order to create a custom global BulkheadConfig or a BulkheadConfig for a specific Bulkhead, you can use the BulkheadConfig builder. You can use the builder to configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>max amount of parallel executions allowed by the bulkhead</p>
</li>
<li>
<p>max amount of time a thread can be blocked for when attempting to enter a saturated bulkhead</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a custom configuration for a Bulkhead</span>
BulkheadConfig config = BulkheadConfig.custom()
                                      .maxConcurrentCalls(<span class="integer">150</span>)
                                      .maxWaitTime(<span class="integer">100</span>)
                                      .build();

<span class="comment">// Create a BulkheadRegistry with a custom global configuration</span>
BulkheadRegistry registry = BulkheadRegistry.of(config);

<span class="comment">// Get-Or-Create a Bulkhead from the registry - bulkhead will be backed by the default config</span>
Bulkhead bulkhead1 = registry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Get-Or-Create a Bulkhead from the registry, use a custom configuration when creating the bulkhead</span>
BulkheadConfig custom = BulkheadConfig.custom()
                                      .maxWaitTime(<span class="integer">0</span>)
                                      .build();

Bulkhead bulkhead2 = registry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, custom);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use the BulkheadRegistry to manage Bulkhead instances, you can also create instances directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Bulkhead bulkhead1 = Bulkhead.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);

Bulkhead bulkhead2 = Bulkhead.of(
                         <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>,
                         BulkheadConfig.custom()
                                       .maxConcurrentCalls(<span class="integer">50</span>)
                                       .build()
                     );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_3"><a class="anchor" href="#_examples_3"></a><a class="link" href="#_examples_3">3.3.3. Examples</a></h4>
<div class="paragraph">
<p>You can decorate any <code>Supplier / Runnable / Function</code> or <code>CheckedSupplier / CheckedRunnable / CheckedFunction</code> function with <code>Bulkhead.decorateCheckedSupplier()</code>, <code>Bulkhead.decorateCheckedRunnable()</code> or <code>Bulkhead.decorateCheckedFunction()</code>.<br>
You can invoke the decorated function with <code>Try.of(&#8230;&#8203;)</code> or <code>Try.run(&#8230;&#8203;)</code> from <a href="https://github.com/javaslang/javaslang">Javaslang</a>. This allows to chain further functions with <code>map</code>, <code>flatMap</code>, <code>filter</code>, <code>recover</code> or <code>andThen</code>. The chained functions are only invoked, if the Bulkhead is not saturated. In the following example, <code>Try.of(&#8230;&#8203;)</code> returns a <code>Success&lt;String&gt;</code> Monad, if the invocation of the function is successful. If the function throws an exception, a <code>Failure&lt;Throwable&gt;</code> Monad is returned and <code>map</code> is not invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
Bulkhead bulkhead = Bulkhead.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>, config);

<span class="comment">// When I decorate my function</span>
CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; decoratedSupplier = Bulkhead.decorateCheckedSupplier(bulkhead, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">This can be any method which returns: 'Hello</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// and chain an other function with map</span>
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(decoratedSupplier)
                        .map(value -&gt; value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> world'</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Then the Try Monad returns a Success&lt;String&gt;, if all functions ran successfully.</span>
assertThat(result.isSuccess()).isTrue();
assertThat(result.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This can be any method which returns: 'Hello world'</span><span class="delimiter">&quot;</span></span>);
assertThat(bulkhead.getMetrics().getAvailableConcurrentCalls()).isEqualTo(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also chain up functions which are decorated by different Bulkheads and/or CircuitBreakers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
Bulkhead bulkhead = Bulkhead.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, config);
Bulkhead anotherBulkhead = Bulkhead.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">testAnother</span><span class="delimiter">&quot;</span></span>, config);

<span class="comment">// When I create a Supplier and a Function which are decorated by different Bulkheads</span>
CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; decoratedSupplier
    = Bulkhead.decorateCheckedSupplier(bulkhead, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);

CheckedFunction1&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; decoratedFunction
    = Bulkhead.decorateCheckedFunction(anotherBulkhead, (input) -&gt; input + <span class="string"><span class="delimiter">&quot;</span><span class="content"> world</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// and I chain a function with map</span>
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(decoratedSupplier)
                        .mapTry(decoratedFunction::apply);

<span class="comment">// Then</span>
assertThat(result.isSuccess()).isTrue();
assertThat(result.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world</span><span class="delimiter">&quot;</span></span>);
assertThat(bulkhead.getMetrics().getAvailableConcurrentCalls()).isEqualTo(<span class="integer">1</span>);
assertThat(anotherBulkhead.getMetrics().getAvailableConcurrentCalls()).isEqualTo(<span class="integer">1</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_bulkhead_reconfiguration"><a class="anchor" href="#_dynamic_bulkhead_reconfiguration"></a><a class="link" href="#_dynamic_bulkhead_reconfiguration">3.3.4. Dynamic bulkhead reconfiguration</a></h4>
<div class="paragraph">
<p>You can use <code>changeConfig</code> method to modify bulkhead params in runtime.<br>
NOTE! New <code>maxWaitTime</code> duration won&#8217;t affect threads that are currently waiting for permission.</p>
</div>
<div class="sect4">
<h5 id="_bulkhead_and_rxjava"><a class="anchor" href="#_bulkhead_and_rxjava"></a><a class="link" href="#_bulkhead_and_rxjava">Bulkhead and RxJava</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate an Observable by using the custom RxJava operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Bulkhead bulkhead = Bulkhead.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Observable</span>.fromCallable(backendService::doSomething)
          .compose(BulkheadOperator.of(bulkhead));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other reactive types (Flowable, Single, Maybe and Completable) are also supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bulkhead_and_reactor"><a class="anchor" href="#_bulkhead_and_reactor"></a><a class="link" href="#_bulkhead_and_reactor">Bulkhead and Reactor</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate a Mono by using the custom Reactor operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Bulkhead bulkhead = Bulkhead.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
Mono.fromCallable(backendService::doSomething)
          .compose(BulkheadOperator.of(bulkhead));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Flux is also supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_saturated_bulkhead_example"><a class="anchor" href="#_saturated_bulkhead_example"></a><a class="link" href="#_saturated_bulkhead_example">Saturated Bulkhead example</a></h5>
<div class="paragraph">
<p>In this example the decorated runnable is not executed because the Bulkhead is saturated and will not allow any more parallel executions. The call to <code>Try.run</code> returns a <code>Failure&lt;Throwable&gt;</code> Monad so that the chained function is not invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given</span>
BulkheadConfig config = BulkheadConfig.custom().maxConcurrentCalls(<span class="integer">2</span>).build();
Bulkhead bulkhead = Bulkhead.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, config);
bulkhead.tryAcquirePermission();
bulkhead.tryAcquirePermission();

<span class="comment">// When</span>
CheckedRunnable checkedRunnable = Bulkhead.decorateCheckedRunnable(bulkhead, () -&gt; {<span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAM!</span><span class="delimiter">&quot;</span></span>);});
Try result = Try.run(checkedRunnable);

<span class="comment">//Then</span>
assertThat(result.isFailure()).isTrue();
assertThat(result.failed().get()).isInstanceOf(BulkheadFullException.class);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_consume_emitted_bulkheadevents"><a class="anchor" href="#_consume_emitted_bulkheadevents"></a><a class="link" href="#_consume_emitted_bulkheadevents">Consume emitted BulkheadEvents</a></h5>
<div class="paragraph">
<p>The BulkHead emits a stream of BulkHeadEvents. There are two types of events emitted: permitted execution, rejected execution &amp; finished execution. If you want to consume these events, you have to register an event consumer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bulkhead.getEventPublisher()
    .onCallPermitted(event -&gt; logger.info(...))
    .onCallRejected(event -&gt; logger.info(...))
    .onCallFinished(event -&gt; logger.info(...));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_3"><a class="anchor" href="#_monitoring_3"></a><a class="link" href="#_monitoring_3">3.3.5. Monitoring</a></h4>
<div class="paragraph">
<p>The Bulkhead provides an interface to monitor the current metrics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Bulkhead.Metrics metrics = bulkhead.getMetrics();
<span class="comment">// Returns the number of parallel executions this bulkhead can support at this point in time.</span>
in remainingBulkheadDepth = metrics.getAvailableConcurrentCalls()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retry"><a class="anchor" href="#_retry"></a><a class="link" href="#_retry">3.4. Retry</a></h3>
<div class="sect3">
<h4 id="_set_up_3"><a class="anchor" href="#_set_up_3"></a><a class="link" href="#_set_up_3">3.4.1. Set-Up</a></h4>
<div class="paragraph">
<p>You can also retry a failed function and recover from the exception, if the maximum retry count was reached. You can create a <code>Retry</code> context using a default configuration as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a Retry context with a default global configuration</span>
<span class="comment">// (maxAttempts = 3, waitDurationInOpenState = 500[ms])</span>
Retry retry = Retry.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to create a custom-configured <code>Retry</code>, you can use the RetryConfig builder. You can configure the maximum number of retry attempts and the wait duration between successive attempts. Furthermore, you can configure a custom Predicate which evaluates if an exception should trigger a retry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RetryConfig config = RetryConfig.custom()
    .maxAttempts(<span class="integer">2</span>)
    .waitDuration(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">100</span>))
    .retryOnResult(response -&gt; response.getStatus() == <span class="integer">500</span>)
    .retryOnException(e -&gt; e <span class="keyword">instanceof</span> WebServiceException)
    .retryExceptions(<span class="exception">IOException</span>.class, <span class="exception">TimeoutException</span>.class)
    .ignoreExceptions(BunsinessException.class, OtherBunsinessException.class)
    .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_4"><a class="anchor" href="#_examples_4"></a><a class="link" href="#_examples_4">3.4.2. Examples</a></h4>
<div class="paragraph">
<p>You can decorate any <code>Supplier / Runnable / Function</code> or <code>CheckedSupplier / CheckedRunnable / CheckedFunction</code> function with <code>Retry.decorateCheckedSupplier()</code>, <code>Retry.decorateCheckedRunnable()</code> or <code>Retry.decorateCheckedFunction()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Given I have a HelloWorldService which throws an exception</span>
HelloWorldService  helloWorldService = mock(HelloWorldService.class);
given(helloWorldService.sayHelloWorld()).willThrow(<span class="keyword">new</span> WebServiceException(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAM!</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// Create a Retry with default configuration</span>
Retry retry = Retry.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Decorate the invocation of the HelloWorldService</span>
CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; retryableSupplier = Retry.decorateCheckedSupplier(retry, helloWorldService::sayHelloWorld);

<span class="comment">// When I invoke the function</span>
Try&lt;<span class="predefined-type">String</span>&gt; result = Try.of(retryableSupplier).recover((throwable) -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world from recovery function</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Then the helloWorldService should be invoked 3 times</span>
BDDMockito.then(helloWorldService).should(times(<span class="integer">3</span>)).sayHelloWorld();
<span class="comment">// and the exception should be handled by the recovery function</span>
assertThat(result.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world from recovery function</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_retry_and_rxjava"><a class="anchor" href="#_retry_and_rxjava"></a><a class="link" href="#_retry_and_rxjava">Retry and RxJava</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate an Observable by using the custom RxJava transformer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Retry retry = Retry.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Observable</span>.fromCallable(backendService::doSomething)
    .compose(RetryTransformer.of(retry))</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_retry_and_reactor"><a class="anchor" href="#_retry_and_reactor"></a><a class="link" href="#_retry_and_reactor">Retry and Reactor</a></h5>
<div class="paragraph">
<p>The following example shows how to decorate a Flux or Mono by using the custom Reactor Operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Retry retry = Retry.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">backendName</span><span class="delimiter">&quot;</span></span>);
Mono.fromCallable(backendService::doSomething)
    .compose(RetryOperator.of(retry))</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_consume_emitted_retryevents"><a class="anchor" href="#_consume_emitted_retryevents"></a><a class="link" href="#_consume_emitted_retryevents">Consume emitted RetryEvents</a></h5>
<div class="paragraph">
<p>The Retry emits a stream of RetryEvents. An event can be a failure which signals that even all retries have failed or success if a retry was successful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">retry.getEventPublisher()
    .onSuccess(event -&gt; logger.info(...))
    .onError(event -&gt; logger.info(...));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cache"><a class="anchor" href="#_cache"></a><a class="link" href="#_cache">3.5. Cache</a></h3>
<div class="sect3">
<h4 id="_set_up_4"><a class="anchor" href="#_set_up_4"></a><a class="link" href="#_set_up_4">3.5.1. Set-Up</a></h4>
<div class="paragraph">
<p>The following example shows how to decorate a lambda expression with a Cache abstraction. The cache abstraction puts the result of the lambda expression in a cache instance (JCache) and<br>
tries to retrieve a previous cached result from the cache before it invokes the lambda expression.<br>
If the cache retrieval from a distributed cache fails, the exception is taken care of and the lambda expression is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a CacheContext by wrapping a JCache instance.</span>
javax.cache.Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cacheInstance = Caching.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheName</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class, <span class="predefined-type">String</span>.class);
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cacheContext = Cache.of(cacheInstance);

<span class="comment">// Decorate your call to BackendService.doSomething()</span>
CheckedFunction1&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cachedFunction = Decorators.ofCheckedSupplier(() -&gt; backendService.doSomething())
    .withCache(cacheContext)
    .decorate();
<span class="predefined-type">String</span> value = Try.of(() -&gt; cachedFunction.apply(<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheKey</span><span class="delimiter">&quot;</span></span>)).get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">3.5.2. Example</a></h4>
<div class="paragraph">
<p>The Cache emits a stream of CacheEvents. An event can be a cache hit, a cache miss or an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cacheContext.getEventPublisher()
    .onCacheHit(event -&gt; logger.info(...))
    .onCacheMiss(event -&gt; logger.info(...))
    .onError(event -&gt; logger.info(...));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timelimiter"><a class="anchor" href="#_timelimiter"></a><a class="link" href="#_timelimiter">3.6. TimeLimiter</a></h3>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a><a class="link" href="#_introduction_5">3.6.1. Introduction</a></h4>
<div class="paragraph">
<p>The TimeLimiter API sets a time limit on the execution of a supplied future. The decorated supplied<br>
future can be chained with a CircuitBreaker to trip the circuit breaker if the supplied<br>
future&#8217;s timeout has exceeded.</p>
</div>
<div class="paragraph">
<p>The TimeLimiter provides the flexibility to handle custom future implementations such as ones that<br>
can cancel its execution gracefully. The TimeLimiter by default is configured to cancel the future<br>
if an exception occurs. This is configurable within the configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples_5"><a class="anchor" href="#_examples_5"></a><a class="link" href="#_examples_5">3.6.2. Examples</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// For example, you want to restrict the execution of a long running task to 60 seconds.</span>
TimeLimiterConfig config = TimeLimiterConfig.custom()
    .timeoutDuration(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">60</span>))
    .cancelRunningFuture(<span class="predefined-constant">true</span>)
    .build();

<span class="comment">// Create TimeLimiter</span>
TimeLimiter timeLimiter = TimeLimiter.of(config);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_timelimiter"><a class="anchor" href="#_using_a_timelimiter"></a><a class="link" href="#_using_a_timelimiter">Using a TimeLimiter</a></h5>
<div class="paragraph">
<p>TimeLimiter takes a Future Supplier and returns a Callable that will unwrap the Future and attempt<br>
to retrieve the future&#8217;s value within the configured timeout period. If the timeout is reached, then<br>
an exception is thrown upstream and TimeLimiter, if configured, will attempt to cancel the future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Run your call to BackendService.doSomething() asynchronously</span>
Supplier&lt;CompletableFuture&lt;<span class="predefined-type">Integer</span>&gt;&gt; futureSupplier = () -&gt; CompletableFuture.supplyAsync(backendService::doSomething);

<span class="comment">// Either execute the future</span>
<span class="predefined-type">Integer</span> result = timeLimiter.executeFutureSupplier(futureSupplier);

<span class="comment">// Or decorate your supplier so that the future can be retrieved and executed upon</span>
<span class="predefined-type">Callable</span> restrictedCall = TimeLimiter
    .decorateFutureSupplier(timeLimiter, futureSupplier);

Try.of(restrictedCall.call)
    .onFailure(throwable -&gt; LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">A timeout possibly occurred.</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_timelimiter_and_circuitbreaker"><a class="anchor" href="#_timelimiter_and_circuitbreaker"></a><a class="link" href="#_timelimiter_and_circuitbreaker">TimeLimiter and CircuitBreaker</a></h5>
<div class="paragraph">
<p>The following example shows how to apply a time limit to a circuit breaker callable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;CompletableFuture&lt;<span class="predefined-type">Integer</span>&gt;&gt; futureSupplier = () -&gt; CompletableFuture.supplyAsync(backendService::doSomething);

<span class="predefined-type">Callable</span> restrictedCall = TimeLimiter
    .decorateFutureSupplier(timeLimiter, futureSupplier);

<span class="comment">// Decorate the restricted callable with a CircuitBreaker</span>
<span class="predefined-type">Callable</span> chainedCallable = CircuitBreaker.decorateCallable(circuitBreaker, restrictedCall);

Try.of(chainedCallable::call)
    .onFailure(throwable -&gt; LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">We might have timed out or the circuit breaker has opened.</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_on_modules_usage_guide"><a class="anchor" href="#_add_on_modules_usage_guide"></a><a class="link" href="#_add_on_modules_usage_guide">4. Add-on modules Usage Guide</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_spring_boot_starter"><a class="anchor" href="#_spring_boot_starter"></a><a class="link" href="#_spring_boot_starter">4.1. Spring Boot Starter</a></h3>
<div class="sect3">
<h4 id="_gradle_2"><a class="anchor" href="#_gradle_2"></a><a class="link" href="#_gradle_2">4.1.1. Gradle</a></h4>
<div class="paragraph">
<p>Add the Spring Boot Starter of Resilience4j to your compile dependency.<br>
You also need Spring Boot Actuator and Spring Boot AOP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
	maven { url 'http://oss.jfrog.org/artifactory/oss-snapshot-local/' }
	mavenCentral()
}


dependencies {
	compile('io.github.resilience4j:resilience4j-spring-boot:0.14.1')
    compile('org.springframework.boot:spring-boot-starter-actuator')
    compile('org.springframework.boot:spring-boot-starter-aop')
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_supported_types_by_spring_boot_starter_resilience_aspects"><a class="anchor" href="#_supported_types_by_spring_boot_starter_resilience_aspects"></a><a class="link" href="#_supported_types_by_spring_boot_starter_resilience_aspects">4.1.2. Supported Types by Spring boot starter resilience aspects</a></h4>
<div class="paragraph">
<p>RateLimiter, Retry, CircuitBreaker and Bulkhead annotations support synchronous return types, asynchronous types like CompletableFutures and reactive types like RxJava2 and Reactor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_4"><a class="anchor" href="#_monitoring_4"></a><a class="link" href="#_monitoring_4">4.1.3. Monitoring</a></h4>
<div class="paragraph">
<p>Spring Boot Actuator health information can be used to check the status of your running application.<br>
It is often used by monitoring software to alert someone if a production system has serious issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="_circuitbreaker_2"><a class="anchor" href="#_circuitbreaker_2"></a><a class="link" href="#_circuitbreaker_2">4.1.4. CircuitBreaker</a></h4>
<div class="paragraph">
<p>The starter publishes the status and metrics of all CircuitBreakers via a custom <code>CircuitBreakerHealthIndicator</code>.<br>
A closed CircuitBreaker state is mapped to UP, an open state to DOWN and a half-open state to UNKNOWN.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">backendACircuitBreaker</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DOWN</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">60.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRateThreshold</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">50.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">maxBufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">bufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">notPermittedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">backendBCircuitBreaker</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRateThreshold</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">50.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">maxBufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">bufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">notPermittedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to publish CircuitBreaker metrics on the Metrics endpoint, you can add <code>resilience4j-metrics</code> to register metrics in a Dropwizard Metrics Registry.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendA.successful</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendA.failed</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendA.buffered</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendA.buffered_max</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendA.not_permitted</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendB.successful</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendB.failed</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendB.buffered</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendB.buffered_max</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.circuitbreaker.backendB.not_permitted</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to publish CircuitBreaker endpoints on the Prometheus endpoint, you have to add the optional module <code>resilience4j-prometheus</code>.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># HELP resilience4j_circuitbreaker_calls Circuit Breaker Call Stats
# TYPE resilience4j_circuitbreaker_calls gauge
resilience4j_circuitbreaker_calls{name="backendB",call_result="successful",} 0.0
resilience4j_circuitbreaker_calls{name="backendB",call_result="failed",} 0.0
resilience4j_circuitbreaker_calls{name="backendB",call_result="not_permitted",} 0.0
resilience4j_circuitbreaker_calls{name="backendB",call_result="buffered",} 0.0
resilience4j_circuitbreaker_calls{name="backendB",call_result="buffered_max",} 10.0
resilience4j_circuitbreaker_calls{name="backendA",call_result="successful",} 0.0
resilience4j_circuitbreaker_calls{name="backendA",call_result="failed",} 0.0
resilience4j_circuitbreaker_calls{name="backendA",call_result="not_permitted",} 0.0
resilience4j_circuitbreaker_calls{name="backendA",call_result="buffered",} 0.0
resilience4j_circuitbreaker_calls{name="backendA",call_result="buffered_max",} 5.0
# HELP resilience4j_circuitbreaker_states Circuit Breaker States
# TYPE resilience4j_circuitbreaker_states gauge
resilience4j_circuitbreaker_states{name="backendB",state="closed",} 1.0
resilience4j_circuitbreaker_states{name="backendB",state="open",} 0.0
resilience4j_circuitbreaker_states{name="backendB",state="half_open",} 0.0
resilience4j_circuitbreaker_states{name="backendA",state="closed",} 1.0
resilience4j_circuitbreaker_states{name="backendA",state="open",} 0.0
resilience4j_circuitbreaker_states{name="backendA",state="half_open",} 0.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retry_2"><a class="anchor" href="#_retry_2"></a><a class="link" href="#_retry_2">4.1.5. Retry</a></h4>
<div class="paragraph">
<p>When you enable retry, metrics are automatically published on the metrics endpoint.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j.retry.backendA.failedCallsWithoutRetry</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j.retry.backendA.failedCallsWithRetry</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j.retry.backendA.successCalls</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j.retry.backendA.successCallsWithRetry</span><span class="delimiter">&quot;</span></span>
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to publish Retry/AsyncRetry endpoints on the Prometheus endpoint, you have to add the dependency <code>io.micrometer:micrometer-registry-prometheus</code>.<br>
and you have same metrics exposed there , check circuit breaker below for more information about the example.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ratelimiter_2"><a class="anchor" href="#_ratelimiter_2"></a><a class="link" href="#_ratelimiter_2">4.1.6. RateLimiter</a></h4>
<div class="paragraph">
<p>The starter publishes the status and metrics of all RateLimiter via a custom <code>RateLimiterHealthIndicator</code>.<br>
RateLimiterHealthIndicator changes its state DOWN only if there is some permission waiting threads<br>
and they won&#8217;t be able to unblock until timeout.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">backendARateLimiter</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">availablePermissions</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">numberOfWaitingThreads</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can publish RateLimiter metrics on the Metrics endpoint,<br>
you can add <code>resilience4j-metrics</code> to register metrics in a Dropwizard Metrics Registry.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.ratelimiter.backendA.available_permissions</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.ratelimiter.backendA.number_of_waiting_threads</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.ratelimiter.backendB.available_permissions</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resilience4j.ratelimiter.backendB.number_of_waiting_threads</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">4.1.7. Configuration</a></h4>
<div class="sect4">
<h5 id="_retry_3"><a class="anchor" href="#_retry_3"></a><a class="link" href="#_retry_3">Retry</a></h5>
<div class="paragraph">
<p>You can configure your Retries in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.retry</span>:
  <span class="key">retryAspectOrder</span>: <span class="string"><span class="content">399</span></span>
  <span class="key">backends</span>:
    <span class="key">retryBackendA</span>:
      <span class="key">maxRetryAttempts</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">waitDuration</span>: <span class="string"><span class="content">600</span></span>
      <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">100</span></span>
      <span class="key">enableExponentialBackoff</span>: <span class="string"><span class="content">false</span></span>
      <span class="key">exponentialBackoffMultiplier</span>: <span class="string"><span class="content">2</span></span>
      <span class="key">enableRandomizedWait</span>: <span class="string"><span class="content">false</span></span>
      <span class="key">randomizedWaitFactor</span>: <span class="string"><span class="content">2</span></span>
      <span class="key">retryExceptionPredicate</span>: <span class="string"><span class="content">io.github.resilience4j.circuitbreaker.RecordFailurePredicate</span></span>
      <span class="key">retryExceptions</span>:
      - <span class="string"><span class="content">java.io.IOException</span></span>
      <span class="key">ignoreExceptions</span>:
      - <span class="string"><span class="content">io.github.resilience4j.circuitbreaker.IgnoredException</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The rules for Retry configuration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default the same back end configuration will be used for sync and async retry configuration if not defined otherwise.</p>
</li>
<li>
<p>enableRandomizedWait and enableExponentialBackoff is false by default.</p>
</li>
<li>
<p>You can not enable both enableRandomizedWait and enableExponentialBackoff , validation exception will be thrown if it happen.</p>
</li>
<li>
<p>If exponentialBackoffMultiplier is not provided if enableExponentialBackoff is enabled , default ExponentialBackoff will be used , same story for enableRandomizedWait.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules for Retry spring annotation usage  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retry aspect will detect the proper handling based into the method return type for synchronous , asynchronous execution(CompletableFuture) , RxJava2 and Reactor</p>
</li>
<li>
<p>Fallback support is enabled by defining name of fallback method in @Retry</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>        @Retry(name = BACKEND, fallbackMethod = "fallback")
        public String sync(String param1) {
            return "test";
        }

        private String fallback(String param1, IllegalStateException e) {
            return "test";
        }</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Its important to remember that Retry method and its fallback method should be placed in the same class and have same method signature (optional parameter for failed execution exception).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Code example of retry and async retry annotation usage in Java Spring component :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="annotation">@Retry</span>(name = RetryDummyService.BACKEND)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RetryDummyServiceImpl</span> <span class="directive">implements</span> RetryDummyService {


<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> doSomething(<span class="type">boolean</span> throwBackendTrouble) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="keyword">if</span> (throwBackendTrouble) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IOException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test Message</span><span class="delimiter">&quot;</span></span>);
        }
}


<span class="annotation">@Override</span>
<span class="directive">public</span> CompletionStage&lt;<span class="predefined-type">String</span>&gt; doSomethingAsync(<span class="type">boolean</span> throwException) <span class="directive">throws</span> <span class="exception">IOException</span> {
    <span class="keyword">if</span> (throwException) {
            CompletableFuture&lt;<span class="predefined-type">String</span>&gt; promise = <span class="keyword">new</span> CompletableFuture&lt;&gt;();
            promise.completeExceptionally(<span class="keyword">new</span> <span class="exception">IOException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test Message</span><span class="delimiter">&quot;</span></span>));
            <span class="keyword">return</span> promise;
    } <span class="keyword">else</span> {
            <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> Flux&lt;<span class="predefined-type">String</span>&gt; doSomethingFlux(<span class="type">boolean</span> throwException) {
        <span class="keyword">if</span> (throwException) {
                <span class="keyword">return</span> Flux.error(<span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">FailedFlux</span><span class="delimiter">&quot;</span></span>));
        }
                <span class="keyword">return</span> Flux.fromArray(<span class="predefined-type">Arrays</span>.array(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>));
        }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> Flowable&lt;<span class="predefined-type">String</span>&gt; doSomethingFlowable(<span class="type">boolean</span> throwException) {
        <span class="keyword">if</span> (throwException) {
                <span class="keyword">return</span> Flowable.error(<span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Failed</span><span class="delimiter">&quot;</span></span>));
        }
            <span class="keyword">return</span> Flowable.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">testMaybe</span><span class="delimiter">&quot;</span></span>);
        }
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond the config file configuration, the Spring Bean configuration is now using @ConditionalOnMissingBean to allow for overriding default behavior.<br>
These Beans can be overridden in your application&#8217;s Spring Bean configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RetryRegistry</p>
</li>
<li>
<p>RetryAspect</p>
</li>
<li>
<p>RxJava2RetryAspectExt</p>
</li>
<li>
<p>ReactorRetryAspectExt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in Spring Boot 1.x, EventConsumerRegistry&lt;RetryEvent&gt; cannot be overridden because of limitations of the @ConditionalOnMissingBean implementation.<br>
To override this, go to at least Spring Boot 2.1.x.</p>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_3"><a class="anchor" href="#_circuitbreaker_3"></a><a class="link" href="#_circuitbreaker_3">CircuitBreaker</a></h5>
<div class="paragraph">
<p>You can configure your CircuitBreakers in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.circuitbreaker</span>:
    <span class="key">backends</span>:
        <span class="key">backendA</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">3</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">5000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">50</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">recordFailurePredicate</span>: <span class="string"><span class="content">com.foo.FooRecordFailurePredicate</span></span>
            <span class="key">recordExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpServerErrorException</span></span>
            <span class="key">ignoreExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpClientErrorException</span></span>
        <span class="key">backendB</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">5000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">50</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">recordFailurePredicate</span>: <span class="string"><span class="content">com.foo.FooRecordFailurePredicate</span></span>
            <span class="key">recordExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpServerErrorException</span></span>
            <span class="key">ignoreExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpClientErrorException</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also override/partial-override/share default configuration for your CircuitBreakers in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.circuitbreaker</span>:
    <span class="key">configs</span>:
        <span class="key">default</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">100</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">10000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">60</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">backends</span>:
        <span class="key">backendA</span>:
            <span class="key">baseConfig</span>: <span class="string"><span class="content">default</span></span>
        <span class="key">backendB</span>:
            <span class="key">baseConfig</span>: <span class="string"><span class="content">default</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond the config file configuration, the Spring Bean configuration is now using @ConditionalOnMissingBean to allow for overriding default behavior.<br>
These Beans can be overridden in your application&#8217;s Spring Bean configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CircuitBreakerRegistry</p>
</li>
<li>
<p>CircuitBreakerAspect</p>
</li>
<li>
<p>RxJava2CircuitBreakerAspectExt</p>
</li>
<li>
<p>ReactorCircuitBreakerAspectExt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in Spring Boot 1.x, EventConsumerRegistry&lt;CircuitBreakerEvent&gt; cannot be overridden because of limitations of the @ConditionalOnMissingBean implementation.<br>
To override this, go to at least Spring Boot 2.1.x.</p>
</div>
<div class="paragraph">
<p>The rules for CircuitBreaker spring annotation usage  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CircuitBreaker aspect with fallback support will detect the proper handling based into the method return type for synchronous , asynchronous execution(CompletableFuture) , RxJava2 and Reactor</p>
</li>
<li>
<p>Fallback support is enabled by defining name of fallback method in @CircuitBreaker</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@CircuitBreaker</span>(name = BACKEND, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> sync() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>;
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Its important to remember that CircuitBreaker method and its fallback method should be placed in the same class and have same method signature (optional parameter for failed execution exception).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_3"><a class="anchor" href="#_ratelimiter_3"></a><a class="link" href="#_ratelimiter_3">RateLimiter</a></h5>
<div class="paragraph">
<p>You can configure your CircuitBreakers in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.ratelimiter</span>:
    <span class="key">limiters</span>:
        <span class="key">backendA</span>:
            <span class="key">limitForPeriod</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">limitRefreshPeriodInMillis</span>: <span class="string"><span class="content">1000</span></span>
            <span class="key">timeoutInMillis</span>: <span class="string"><span class="content">0</span></span>
            <span class="key">subscribeForEvents</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">100</span></span>
        <span class="key">backendB</span>:
            <span class="key">limitForPeriod</span>: <span class="string"><span class="content">6</span></span>
            <span class="key">limitRefreshPeriodInMillis</span>: <span class="string"><span class="content">500</span></span>
            <span class="key">timeoutInMillis</span>: <span class="string"><span class="content">3000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond the config file configuration, the Spring Bean configuration is now using @ConditionalOnMissingBean to allow for overriding default behavior.<br>
These Beans can be overridden in your application&#8217;s Spring Bean configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RateLimiterRegistry</p>
</li>
<li>
<p>RateLimiterAspect</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in Spring Boot 1.x, EventConsumerRegistry&lt;RateLimiterEvent&gt; cannot be overridden because of limitations of the @ConditionalOnMissingBean implementation.<br>
To override this, go to at least Spring Boot 2.1.x.</p>
</div>
<div class="paragraph">
<p>The rules for RateLimiter spring annotation usage  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RateLimiter aspect with fallback support will detect the proper handling based into the method return type for synchronous , asynchronous execution(CompletableFuture) , RxJava2 and Reactor</p>
</li>
<li>
<p>Fallback support is enabled by defining name of fallback method in @RateLimiter</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RateLimiter</span>(name = BACKEND, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> sync() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>;
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Its important to remember that RateLimiter method and its fallback method should be placed in the same class and have same method signature (optional parameter for failed execution exception).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_explicit_ordering_for_circuitbreaker_and_ratelimiter_aspects"><a class="anchor" href="#_explicit_ordering_for_circuitbreaker_and_ratelimiter_aspects"></a><a class="link" href="#_explicit_ordering_for_circuitbreaker_and_ratelimiter_aspects">Explicit ordering for CircuitBreaker and RateLimiter aspects</a></h5>
<div class="paragraph">
<p>You can adjust <code>RateLimiterProperties.rateLimiterAspectOrder</code> and <code>CircuitBreakerProperties.circuitBreakerAspectOrder</code><br>
and explicitly define <code>CircuitBreaker</code> and <code>RateLimiter</code> execution sequence.<br>
By default <code>CircuitBreaker</code> will be executed BEFORE <code>RateLimiter</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please be careful changing of <code>CircuitBreaker</code>/<code>RateLimiter</code> ordering can drastically change application behavior.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_monitoring"><a class="anchor" href="#_event_monitoring"></a><a class="link" href="#_event_monitoring">4.1.8. Event Monitoring</a></h4>
<div class="sect4">
<h5 id="_retry_4"><a class="anchor" href="#_retry_4"></a><a class="link" href="#_retry_4">Retry</a></h5>
<div class="paragraph">
<p>The emitted Retry events are stored in a separate circular event consumer buffers. The size of a event consumer buffer can be configured per Retry in the application.yml file (eventConsumerBufferSize).<br>
The demo adds a custom Spring Boot Actuator endpoint which can be used to monitor the emitted events of your Retries.<br>
The endpoint <code>/management/retries</code> lists the names of all Retries instances.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retries": [
    "retryBackendA",
    "retryBackendA"
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/management/retries/events</code> lists the latest 100 emitted events of all Retries instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retryEvents": [
    {
      "retryName": "retryBackendC",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:49.648+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 1
    },
    {
      "retryName": "retryBackendA",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:50.259+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 2
    },
    {
      "retryName": "retryBackendA",
      "type": "ERROR",
      "creationTime": "2019-03-11T17:32:50.866+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 3
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/management/retries/events/{retryrName}</code> lists the latest emitted events of a specific Retry.<br>
For example <code>/management/retries/events/retryBackendA</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retryEvents": [
    {
      "retryName": "retryBackendA",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:49.648+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 1
    },
    {
      "retryName": "retryBackendA",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:50.259+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 2
    },
    {
      "retryName": "retryBackendA",
      "type": "ERROR",
      "creationTime": "2019-03-11T17:32:50.866+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 3
    }
  ]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_4"><a class="anchor" href="#_circuitbreaker_4"></a><a class="link" href="#_circuitbreaker_4">CircuitBreaker</a></h5>
<div class="paragraph">
<p>The emitted CircuitBreaker events are stored in a separate circular event consumer buffers. The size of a event consumer buffer can be configured per CircuitBreaker in the application.yml file (eventConsumerBufferSize).<br>
The demo adds a custom Spring Boot Actuator endpoint which can be used to monitor the emitted events of your CircuitBreakers.<br>
The endpoint <code>/management/circuitbreaker</code> lists the names of all CircuitBreaker instances.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "circuitBreakers": [
      "backendA",
      "backendB"
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/management/circuitbreaker/events</code> lists the latest 100 emitted events of all CircuitBreaker instances.<br>
The endpoint <code>/management/circuitbreaker/stream/events</code> streams emitted events of all CircuitBreaker instances using Server-Sent Events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:39:17.117+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:39:20.518+01:00[Europe/Berlin]",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendB",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:41:31.159+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendB",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:41:33.526+01:00[Europe/Berlin]",
    "durationInMs": 0
  }
]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/management/circuitbreaker/events/{circuitBreakerName}</code> lists the latest emitted events of a specific CircuitBreaker.<br>
The endpoint <code>/management/circuitbreaker/stream/events/{circuitBreakerName}</code> streams emitted events using Server-Sent Events.<br>
For example <code>/management/circuitbreaker/events/backendA</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:39:17.117+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:39:20.518+01:00[Europe/Berlin]",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "STATE_TRANSITION",
    "creationTime": "2017-01-10T15:39:22.341+01:00[Europe/Berlin]",
    "stateTransition": "CLOSED_TO_OPEN"
  },
  {
    "circuitBreakerName": "backendA",
    "type": "NOT_PERMITTED",
    "creationTime": "2017-01-10T15:39:22.780+01:00[Europe/Berlin]"
  }
]
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can even filter the list of  events.<br>
The endpoint <code>/management/circuitbreaker/events/{circuitBreakerName}/{eventType}</code> lists the filtered events.<br>
The endpoint <code>/management/circuitbreaker/stream/events/{circuitBreakerName}/{eventType}</code> streams emitted events using Server-Sent Events.<br>
Event types can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ERROR: A CircuitBreakerEvent which informs that an error has been recorded.</p>
</li>
<li>
<p>IGNORED_ERROR: A CircuitBreakerEvent which informs that an error has been ignored.</p>
</li>
<li>
<p>SUCCESS: A CircuitBreakerEvent which informs that a success has been recorded.</p>
</li>
<li>
<p>NOT_PERMITTED: A CircuitBreakerEvent which informs that a call was not permitted because the CircuitBreaker state is OPEN.</p>
</li>
<li>
<p>STATE_TRANSITION: A CircuitBreakerEvent which informs the state of the CircuitBreaker has been changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example <code>/management/circuitbreaker/events/backendA/ERROR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:42:59.324+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:43:22.802+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  }
]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_4"><a class="anchor" href="#_ratelimiter_4"></a><a class="link" href="#_ratelimiter_4">RateLimiter</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Unlike the CircuitBreaker events, RateLimiter events require explicit subscription.<br>
Use property resilience4j.ratelimiter.limiters.{yourBackendName}.registerHealthIndicator=true
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are literally the same endpoints implemented for RateLimiter,<br>
so for detailed documentation please refer to previous section:</p>
</div>
<div class="paragraph">
<p>List of available endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/ratelimiter/events</code></p>
</li>
<li>
<p><code>/ratelimiter/stream/events</code></p>
</li>
<li>
<p><code>/ratelimiter/events/{rateLimiterName}</code></p>
</li>
<li>
<p><code>/ratelimiter/stream/events/{rateLimiterName}</code></p>
</li>
<li>
<p><code>/ratelimiter/events/{rateLimiterName}/{eventType}</code></p>
</li>
<li>
<p><code>/ratelimiter/stream/events/{rateLimiterName}/{eventType}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "eventsList": [
    {
      "rateLimiterName": "backendA",
      "type": "SUCCESSFUL_ACQUIRE",
      "creationTime": "2017-05-05T21:29:40.463+03:00[Europe/Uzhgorod]"
    },
    {
      "rateLimiterName": "backendA",
      "type": "SUCCESSFUL_ACQUIRE",
      "creationTime": "2017-05-05T21:29:40.469+03:00[Europe/Uzhgorod]"
    },
    {
      "rateLimiterName": "backendA",
      "type": "FAILED_ACQUIRE",
      "creationTime": "2017-05-05T21:29:41.268+03:00[Europe/Uzhgorod]"
    }
  ]
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot_2_starter"><a class="anchor" href="#_spring_boot_2_starter"></a><a class="link" href="#_spring_boot_2_starter">4.2. Spring Boot 2 Starter</a></h3>
<div class="sect3">
<h4 id="_gradle_3"><a class="anchor" href="#_gradle_3"></a><a class="link" href="#_gradle_3">4.2.1. Gradle</a></h4>
<div class="paragraph">
<p>Add the Spring Boot 2 Starter of Resilience4j to your compile dependency.<br>
You also need Spring Boot Actuator and Spring Boot AOP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
	maven { url 'http://oss.jfrog.org/artifactory/oss-snapshot-local/' }
	mavenCentral()
}


dependencies {
	compile('io.github.resilience4j:resilience4j-spring-boot2:0.14.1')
    compile('org.springframework.boot:spring-boot-starter-actuator')
    compile('org.springframework.boot:spring-boot-starter-aop')
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_supported_types_by_spring_boot_starter_resilience_aspects_2"><a class="anchor" href="#_supported_types_by_spring_boot_starter_resilience_aspects_2"></a><a class="link" href="#_supported_types_by_spring_boot_starter_resilience_aspects_2">4.2.2. Supported Types by Spring boot starter resilience aspects</a></h4>
<div class="paragraph">
<p>RateLimiter, Retry, CircuitBreaker and Bulkhead annotations support synchronous return types, asynchronous types like CompletableFutures and reactive types like RxJava2 and Reactor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_5"><a class="anchor" href="#_monitoring_5"></a><a class="link" href="#_monitoring_5">4.2.3. Monitoring</a></h4>
<div class="paragraph">
<p>Spring Boot Actuator health information can be used to check the status of your running application.<br>
It is often used by monitoring software to alert someone if a production system has serious issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="_circuitbreaker_5"><a class="anchor" href="#_circuitbreaker_5"></a><a class="link" href="#_circuitbreaker_5">4.2.4. CircuitBreaker</a></h4>
<div class="paragraph">
<p>The starter publishes the status and metrics of all CircuitBreakers via a custom <code>CircuitBreakerHealthIndicator</code>.<br>
A closed CircuitBreaker state is mapped to UP, an open state to DOWN and a half-open state to UNKNOWN.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">backendACircuitBreaker</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DOWN</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">60.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRateThreshold</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">50.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">maxBufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">bufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">notPermittedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">backendBCircuitBreaker</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failureRateThreshold</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">50.0%</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">maxBufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">bufferedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">failedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">notPermittedCalls</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Metrics are automatically published on the Metrics endpoint.<br>
To retrieve the names of the available metrics, make a GET request to <code>/actuator/metrics</code>.<br>
Please see <a href="https://docs.spring.io/spring-boot/docs/current/actuator-api/html/#metrics">Actuator Metrics documentation</a> for more details.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_circuitbreaker_calls</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_circuitbreaker_max_buffered_calls</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_circuitbreaker_buffered_calls</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_circuitbreaker_state</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_circuitbreaker_failure_rate</span><span class="delimiter">&quot;</span></span>
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve a metric, make a GET request to <code>/actuator/metrics/{metric.name}</code>.<br>
For example: <code>/actuator/metrics/resilience4j_circuitbreaker_calls</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_circuitbreaker_calls</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">measurements</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">statistic</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">VALUE</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>
        }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">availableTags</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kind</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">not_permitted</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>
            ]
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendB</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to publish CircuitBreaker endpoints on the Prometheus endpoint, you have to add the dependency <code>io.micrometer:micrometer-registry-prometheus</code>.<br>
To retrieve metrics, make a GET request to <code>/actuator/prometheus</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>resilience4j_circuitbreaker_calls{kind="not_permitted",name="backendA",} 0.0
resilience4j_circuitbreaker_calls{kind="not_permitted",name="backendB",} 0.0
resilience4j_circuitbreaker_calls{kind="successful",name="backendA",} 5.0
resilience4j_circuitbreaker_calls{kind="successful",name="backendB",} 8.0
resilience4j_circuitbreaker_calls{kind="failed",name="backendB",} 2.0
resilience4j_circuitbreaker_calls{kind="failed",name="backendA",} 5.0

resilience4j_circuitbreaker_state{name="backendA",} 0.0
resilience4j_circuitbreaker_state{name="backendB",} 0.0

resilience4j_circuitbreaker_failure_rate{name="backendA",} 50.0
resilience4j_circuitbreaker_failure_rate{name="backendB",} 20.0

resilience4j_circuitbreaker_max_buffered_calls{name="backendA",} 10.0
resilience4j_circuitbreaker_max_buffered_calls{name="backendB",} 10.0

resilience4j_circuitbreaker_buffered_calls{name="backendA",} 10.0
resilience4j_circuitbreaker_buffered_calls{name="backendB",} 10.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retry_5"><a class="anchor" href="#_retry_5"></a><a class="link" href="#_retry_5">4.2.5. Retry</a></h4>
<div class="paragraph">
<p>Metrics are automatically published on the metrics endpoint.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_retry_calls</span><span class="delimiter">&quot;</span></span>
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve the metric, make a GET request to <code>/actuator/metrics/{metric.name}</code>.<br>
For example: <code>/actuator/metrics/resilience4j_retry_calls</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_retry_calls</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">measurements</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">statistic</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">VALUE</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>
        }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">availableTags</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kind</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">successful_without_retry</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">successful_with_retry</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">failed_with_retry</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">failed_without_retry</span><span class="delimiter">&quot;</span></span>
            ]
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendB</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to publish Retry/AsyncRetry endpoints on the Prometheus endpoint, you have to add the dependency <code>io.micrometer:micrometer-registry-prometheus</code>.<br>
and you have same metrics exposed there , check circuit breaker below for more information about the example.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bulkhead_2"><a class="anchor" href="#_bulkhead_2"></a><a class="link" href="#_bulkhead_2">4.2.6. Bulkhead</a></h4>
<div class="paragraph">
<p>Metrics are automatically published on the Metrics endpoint.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_bulkhead_available_concurrent_calls</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_bulkhead_max_allowed_concurrent_calls</span><span class="delimiter">&quot;</span></span>
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve the metric, make a GET request to <code>/actuator/metrics/{metric.name}</code>.<br>
For example: <code>/actuator/metrics/resilience4j_bulkhead_available_concurrent_calls</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_bulkhead_available_concurrent_calls</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">measurements</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">statistic</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">VALUE</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>
        }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">availableTags</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendB</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>
            ]
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ratelimiter_5"><a class="anchor" href="#_ratelimiter_5"></a><a class="link" href="#_ratelimiter_5">4.2.7. RateLimiter</a></h4>
<div class="paragraph">
<p>The starter the status and metrics of all RateLimiter via a custom <code>RateLimiterHealthIndicator</code>.<br>
RateLimiterHealthIndicator changes its state DOWN only if there is some permission waiting threads<br>
and they won&#8217;t be able to unblock until timeout.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">backendARateLimiter</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">availablePermissions</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">numberOfWaitingThreads</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Metrics are automatically published on the Metrics endpoint.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_ratelimiter_available_permissions</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_ratelimiter_waiting_threads</span><span class="delimiter">&quot;</span></span>
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve the metric, make a GET request to <code>/actuator/metrics/{metric.name}</code>.<br>
For example: <code>/actuator/metrics/resilience4j_ratelimiter_available_permissions</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">resilience4j_ratelimiter_available_permissions</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">measurements</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">statistic</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">VALUE</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">50</span>
        }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">availableTags</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>
            ]
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a><a class="link" href="#_configuration_2">4.2.8. Configuration</a></h4>
<div class="sect4">
<h5 id="_retry_6"><a class="anchor" href="#_retry_6"></a><a class="link" href="#_retry_6">Retry</a></h5>
<div class="paragraph">
<p>You can configure your Retries in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.retry</span>:
  <span class="key">retryAspectOrder</span>: <span class="string"><span class="content">399</span></span>
  <span class="key">backends</span>:
    <span class="key">retryBackendA</span>:
      <span class="key">maxRetryAttempts</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">waitDuration</span>: <span class="string"><span class="content">600</span></span>
      <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">100</span></span>
      <span class="key">enableExponentialBackoff</span>: <span class="string"><span class="content">false</span></span>
      <span class="key">exponentialBackoffMultiplier</span>: <span class="string"><span class="content">2</span></span>
      <span class="key">enableRandomizedWait</span>: <span class="string"><span class="content">false</span></span>
      <span class="key">randomizedWaitFactor</span>: <span class="string"><span class="content">2</span></span>
      <span class="key">retryExceptionPredicate</span>: <span class="string"><span class="content">io.github.resilience4j.circuitbreaker.RecordFailurePredicate</span></span>
      <span class="key">retryExceptions</span>:
      - <span class="string"><span class="content">java.io.IOException</span></span>
      <span class="key">ignoreExceptions</span>:
      - <span class="string"><span class="content">io.github.resilience4j.circuitbreaker.IgnoredException</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The rules for Retry configuration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enableRandomizedWait and enableExponentialBackoff is false by default.</p>
</li>
<li>
<p>You can not enable both enableRandomizedWait and enableExponentialBackoff , validation exception will be thrown if it happen.</p>
</li>
<li>
<p>If exponentialBackoffMultiplier is not provided if enableExponentialBackoff is enabled , default ExponentialBackoff will be used , same story for enableRandomizedWait.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules for Retry spring annotation usage  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retry aspect will detect the proper handling based into the method return type for synchronous , asynchronous execution(CompletableFuture) , RxJava2 and Reactor</p>
</li>
<li>
<p>Fallback support is enabled by defining name of fallback method in @Retry</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>            @Retry(name = BACKEND, fallbackMethod = "fallback")
            public String sync(String param1) {
                return "test";
            }

            private String fallback(String param1, IllegalStateException e) {
                return "test";
            }</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Its important to remember that Retry method and its fallback method should be placed in the same class and have same method signature (optional parameter for failed execution exception).</p>
</li>
<li>
<p>If there are multiple fallbackMethod methods, one of the methods that has most closest superclass parameter of thrown object will be invoked, for example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>            @Retry(name = BACKEND, fallbackMethod = "fallback")
            public String sync(String param1) {
                return "test";
            }

            private String fallback(String param1, IllegalArgumentException e) {
                return "test";
            }

            private String fallback(String param1, RuntimeException e) {
                 return "test";
            }</pre>
</div>
</div>
<div class="paragraph">
<p>and if you try to recover from  NumberFormatException, the method with signature String fallback(String parameter, IllegalArgumentException exception)} will be invoked.</p>
</div>
<div class="paragraph">
<p>Code example of Sync, Async, Reactive retry annotation usage in Java Spring component :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="annotation">@Retry</span>(name = RetryDummyService.BACKEND)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RetryDummyServiceImpl</span> <span class="directive">implements</span> RetryDummyService {


<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> doSomething(<span class="type">boolean</span> throwBackendTrouble) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="keyword">if</span> (throwBackendTrouble) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IOException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test Message</span><span class="delimiter">&quot;</span></span>);
        }
}


<span class="annotation">@Override</span>
<span class="directive">public</span> CompletionStage&lt;<span class="predefined-type">String</span>&gt; doSomethingAsync(<span class="type">boolean</span> throwException) <span class="directive">throws</span> <span class="exception">IOException</span> {
    <span class="keyword">if</span> (throwException) {
            CompletableFuture&lt;<span class="predefined-type">String</span>&gt; promise = <span class="keyword">new</span> CompletableFuture&lt;&gt;();
            promise.completeExceptionally(<span class="keyword">new</span> <span class="exception">IOException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test Message</span><span class="delimiter">&quot;</span></span>));
            <span class="keyword">return</span> promise;
    } <span class="keyword">else</span> {
            <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> Flux&lt;<span class="predefined-type">String</span>&gt; doSomethingFlux(<span class="type">boolean</span> throwException) {
        <span class="keyword">if</span> (throwException) {
                <span class="keyword">return</span> Flux.error(<span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">FailedFlux</span><span class="delimiter">&quot;</span></span>));
        }
                <span class="keyword">return</span> Flux.fromArray(<span class="predefined-type">Arrays</span>.array(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>));
        }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> Flowable&lt;<span class="predefined-type">String</span>&gt; doSomethingFlowable(<span class="type">boolean</span> throwException) {
        <span class="keyword">if</span> (throwException) {
                <span class="keyword">return</span> Flowable.error(<span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Failed</span><span class="delimiter">&quot;</span></span>));
        }
            <span class="keyword">return</span> Flowable.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">testMaybe</span><span class="delimiter">&quot;</span></span>);
        }
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond the config file configuration, the Spring Bean configuration is now using @ConditionalOnMissingBean to allow for overriding default behavior.<br>
These Beans can be overridden in your application&#8217;s Spring Bean configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RetryRegistry</p>
</li>
<li>
<p>RetryAspect</p>
</li>
<li>
<p>EventConsumerRegistry&lt;RetryEvent&gt;</p>
</li>
<li>
<p>RxJava2RetryAspectExt</p>
</li>
<li>
<p>ReactorRetryAspectExt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in Spring Boot 1.x, EventConsumerRegistry&lt;RetryEvent&gt; cannot be overridden because of limitations of the @ConditionalOnMissingBean implementation.<br>
To override this, go to at least Spring Boot 2.1.x.</p>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_6"><a class="anchor" href="#_circuitbreaker_6"></a><a class="link" href="#_circuitbreaker_6">CircuitBreaker</a></h5>
<div class="paragraph">
<p>You can configure your CircuitBreakers in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.circuitbreaker</span>:
    <span class="key">backends</span>:
        <span class="key">backendA</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">3</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">5000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">50</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">recordFailurePredicate</span>: <span class="string"><span class="content">com.foo.FooRecordFailurePredicate</span></span>
            <span class="key">recordExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpServerErrorException</span></span>
            <span class="key">ignoreExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpClientErrorException</span></span>
        <span class="key">backendB</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">5</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">5000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">50</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">recordFailurePredicate</span>: <span class="string"><span class="content">com.foo.FooRecordFailurePredicate</span></span>
            <span class="key">recordExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpServerErrorException</span></span>
            <span class="key">ignoreExceptions</span>:
                - <span class="string"><span class="content">org.springframework.web.client.HttpClientErrorException</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also override/partial-override/share default configuration for your CircuitBreakers in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.circuitbreaker</span>:
    <span class="key">configs</span>:
        <span class="key">default</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">100</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">10000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">60</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">backends</span>:
        <span class="key">backendA</span>:
            <span class="key">baseConfig</span>: <span class="string"><span class="content">default</span></span>
        <span class="key">backendB</span>:
            <span class="key">baseConfig</span>: <span class="string"><span class="content">default</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond the config file configuration, the Spring Bean configuration is now using @ConditionalOnMissingBean to allow for overriding default behavior.<br>
These Beans can be overridden in your application&#8217;s Spring Bean configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CircuitBreakerRegistry</p>
</li>
<li>
<p>CircuitBreakerAspect</p>
</li>
<li>
<p>RxJava2CircuitBreakerAspectExt</p>
</li>
<li>
<p>ReactorCircuitBreakerAspectExt</p>
</li>
<li>
<p>EventConsumerRegistry&lt;CircuitBreakerEvent&gt;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules for CircuitBreaker spring annotation usage  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CircuitBreaker aspect with fallback support will detect the proper handling based into the method return type for synchronous , asynchronous execution(CompletableFuture) , RxJava2 and Reactor</p>
</li>
<li>
<p>Fallback support is enabled by defining name of fallback method in @CircuitBreaker</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@CircuitBreaker</span>(name = BACKEND, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> sync() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>;
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Its important to remember that CircuitBreaker method and its fallback method should be placed in the same class and have same method signature (optional parameter for failed execution exception).</p>
</li>
<li>
<p>If there are multiple fallbackMethod methods, one of the methods that has most closest superclass parameter of thrown object will be invoked, for example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>                @CircuitBreaker(name = BACKEND, fallbackMethod = "fallback")
                public String sync(String param1) {
                    return "test";
                }

                private String fallback(String param1, IllegalArgumentException e) {
                    return "test";
                }

                private String fallback(String param1, RuntimeException e) {
                     return "test";
                }</pre>
</div>
</div>
<div class="paragraph">
<p>and if you try to recover from  NumberFormatException, the method with signature String fallback(String parameter, IllegalArgumentException exception) will be invoked.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_6"><a class="anchor" href="#_ratelimiter_6"></a><a class="link" href="#_ratelimiter_6">RateLimiter</a></h5>
<div class="paragraph">
<p>You can configure your CircuitBreakers in Spring Boot&#8217;s <code>application.yml</code> config file.<br>
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j.ratelimiter</span>:
    <span class="key">limiters</span>:
        <span class="key">backendA</span>:
            <span class="key">limitForPeriod</span>: <span class="string"><span class="content">10</span></span>
            <span class="key">limitRefreshPeriodInMillis</span>: <span class="string"><span class="content">1000</span></span>
            <span class="key">timeoutInMillis</span>: <span class="string"><span class="content">0</span></span>
            <span class="key">subscribeForEvents</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">registerHealthIndicator</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">eventConsumerBufferSize</span>: <span class="string"><span class="content">100</span></span>
        <span class="key">backendB</span>:
            <span class="key">limitForPeriod</span>: <span class="string"><span class="content">6</span></span>
            <span class="key">limitRefreshPeriodInMillis</span>: <span class="string"><span class="content">500</span></span>
            <span class="key">timeoutInMillis</span>: <span class="string"><span class="content">3000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond the config file configuration, the Spring Bean configuration is now using @ConditionalOnMissingBean to allow for overriding default behavior.<br>
These Beans can be overridden in your application&#8217;s Spring Bean configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RateLimiterRegistry</p>
</li>
<li>
<p>RateLimiterAspect</p>
</li>
<li>
<p>EventConsumerRegistry&lt;RateLimiterEvent&gt;</p>
</li>
<li>
<p>RxJava2RateLimiterAspectExt</p>
</li>
<li>
<p>ReactorRateLimiterAspectExt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules for RateLimiter spring annotation usage  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RateLimiter aspect with fallback support will detect the proper handling based into the method return type for synchronous , asynchronous execution(CompletableFuture) , RxJava2 and Reactor</p>
</li>
<li>
<p>Fallback support is enabled by defining name of fallback method in @RateLimiter</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RateLimiter</span>(name = BACKEND, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> sync() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>;
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Its important to remember that RateLimiter method and its fallback method should be placed in the same class and have same method signature (optional parameter for failed execution exception).</p>
</li>
<li>
<p>If there are multiple fallbackMethod methods, one of the methods that has most closest superclass parameter of thrown object will be invoked, for example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>                @RateLimiter(name = BACKEND, fallbackMethod = "fallback")
                public String sync(String param1) {
                    return "test";
                }

                private String fallback(String param1, IllegalArgumentException e) {
                    return "test";
                }

                private String fallback(String param1, RuntimeException e) {
                     return "test";
                }</pre>
</div>
</div>
<div class="paragraph">
<p>and if you try to recover from  NumberFormatException, the method with signature String fallback(String parameter, IllegalArgumentException exception) will be invoked.</p>
</div>
</div>
<div class="sect4">
<h5 id="_explicit_ordering_for_circuitbreaker_and_ratelimiter_aspects_2"><a class="anchor" href="#_explicit_ordering_for_circuitbreaker_and_ratelimiter_aspects_2"></a><a class="link" href="#_explicit_ordering_for_circuitbreaker_and_ratelimiter_aspects_2">Explicit ordering for CircuitBreaker and RateLimiter aspects</a></h5>
<div class="paragraph">
<p>You can adjust <code>RateLimiterProperties.rateLimiterAspectOrder</code> and <code>CircuitBreakerProperties.circuitBreakerAspectOrder</code><br>
and explicitly define <code>CircuitBreaker</code> and <code>RateLimiter</code> execution sequence.<br>
By default <code>CircuitBreaker</code> will be executed BEFORE <code>RateLimiter</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please be careful changing of <code>CircuitBreaker</code>/<code>RateLimiter</code> ordering can drastically change application behavior.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_monitoring_2"><a class="anchor" href="#_event_monitoring_2"></a><a class="link" href="#_event_monitoring_2">4.2.9. Event Monitoring</a></h4>
<div class="sect4">
<h5 id="_retry_7"><a class="anchor" href="#_retry_7"></a><a class="link" href="#_retry_7">Retry</a></h5>
<div class="paragraph">
<p>The emitted Retry events are stored in a separate circular event consumer buffers. The size of a event consumer buffer can be configured per Retry in the application.yml file (eventConsumerBufferSize).<br>
The demo adds a custom Spring Boot Actuator endpoint which can be used to monitor the emitted events of your Retries.<br>
The endpoint <code>/actuator/retries</code> lists the names of all Retries instances.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retries": [
    "retryBackendA",
    "retryBackendA"
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/actuator/retriesevents</code> lists the latest 100 emitted events of all Retries instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retryEvents": [
    {
      "retryName": "retryBackendC",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:49.648+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 1
    },
    {
      "retryName": "retryBackendA",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:50.259+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 2
    },
    {
      "retryName": "retryBackendA",
      "type": "ERROR",
      "creationTime": "2019-03-11T17:32:50.866+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 3
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/actuator/retryevents/{retryrName}</code> lists the latest emitted events of a specific Retry.<br>
For example <code>/actuator/retryevents/retryBackendA</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retryEvents": [
    {
      "retryName": "retryBackendA",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:49.648+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 1
    },
    {
      "retryName": "retryBackendA",
      "type": "RETRY",
      "creationTime": "2019-03-11T17:32:50.259+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 2
    },
    {
      "retryName": "retryBackendA",
      "type": "ERROR",
      "creationTime": "2019-03-11T17:32:50.866+01:00[Europe/Brussels]",
      "errorMessage": "java.io.IOException: Test Message",
      "numberOfAttempts": 3
    }
  ]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_7"><a class="anchor" href="#_circuitbreaker_7"></a><a class="link" href="#_circuitbreaker_7">CircuitBreaker</a></h5>
<div class="paragraph">
<p>The emitted CircuitBreaker events are stored in a separate circular event consumer buffers. The size of a event consumer buffer can be configured per CircuitBreaker in the application.yml file (eventConsumerBufferSize).<br>
The demo adds a custom Spring Boot Actuator endpoint which can be used to monitor the emitted events of your CircuitBreakers.<br>
The endpoint <code>/actuator/circuitbreakers</code> lists the names of all CircuitBreaker instances.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "circuitBreakers": [
      "backendA",
      "backendB"
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/management/circuitbreaker-events</code> lists the latest 100 emitted events of all CircuitBreaker instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:39:17.117+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:39:20.518+01:00[Europe/Berlin]",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendB",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:41:31.159+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendB",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:41:33.526+01:00[Europe/Berlin]",
    "durationInMs": 0
  }
]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/management/circuitbreaker/events/{circuitBreakerName}</code> lists the latest emitted events of a specific CircuitBreaker.<br>
For example <code>/management/circuitbreaker/events/backendA</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:39:17.117+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:39:20.518+01:00[Europe/Berlin]",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "STATE_TRANSITION",
    "creationTime": "2017-01-10T15:39:22.341+01:00[Europe/Berlin]",
    "stateTransition": "CLOSED_TO_OPEN"
  },
  {
    "circuitBreakerName": "backendA",
    "type": "NOT_PERMITTED",
    "creationTime": "2017-01-10T15:39:22.780+01:00[Europe/Berlin]"
  }
]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_7"><a class="anchor" href="#_ratelimiter_7"></a><a class="link" href="#_ratelimiter_7">RateLimiter</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Unlike the CircuitBreaker events, RateLimiter events require explicit subscription.<br>
Use property resilience4j.ratelimiter.limiters.{yourBackendName}.registerHealthIndicator=true
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are literally the same endpoints implemented for RateLimiter,<br>
so for detailed documentation please refer to previous section:</p>
</div>
<div class="paragraph">
<p>List of available endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/ratelimiters</code></p>
</li>
<li>
<p><code>/ratelimiter-events</code></p>
</li>
<li>
<p><code>/ratelimiter-events/{rateLimiterName}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "eventsList": [
    {
      "rateLimiterName": "backendA",
      "type": "SUCCESSFUL_ACQUIRE",
      "creationTime": "2017-05-05T21:29:40.463+03:00[Europe/Uzhgorod]"
    },
    {
      "rateLimiterName": "backendA",
      "type": "SUCCESSFUL_ACQUIRE",
      "creationTime": "2017-05-05T21:29:40.469+03:00[Europe/Uzhgorod]"
    },
    {
      "rateLimiterName": "backendA",
      "type": "FAILED_ACQUIRE",
      "creationTime": "2017-05-05T21:29:41.268+03:00[Europe/Uzhgorod]"
    }
  ]
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ratpack_starter"><a class="anchor" href="#_ratpack_starter"></a><a class="link" href="#_ratpack_starter">4.3. Ratpack Starter</a></h3>
<div class="paragraph">
<p>This add-on provides integration with <a href="https://ratpack.io">Ratpack</a> libraries.</p>
</div>
<div class="sect3">
<h4 id="_gradle_4"><a class="anchor" href="#_gradle_4"></a><a class="link" href="#_gradle_4">4.3.1. Gradle</a></h4>
<div class="paragraph">
<p>Add the Ratpack Starter of Resilience4j to your compile dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>repositories {
	maven { url 'http://oss.jfrog.org/artifactory/oss-snapshot-local/' }
	mavenCentral()
}


dependencies {
	compile('io.github.resilience4j:resilience4j-ratpack:{release-version}')
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_basic_usage"><a class="anchor" href="#_basic_usage"></a><a class="link" href="#_basic_usage">4.3.2. Basic Usage</a></h4>
<div class="paragraph">
<p>Installing the <code>Resilience4jModule</code> module provides a <code>BulkheadRegistry</code> <code>CircuitBreakerRegistry</code>, <code>RateLimiterRegistry</code>,<br>
and <code>RetryRegistry</code> with the default configurations. It also install the Guice method interceptors<br>
for Bulkheads, CircuitBreakers, RateLimiters, and Retries. Finally, it allows configuration of metrics<br>
and even the building of Bulkheads, CircuitBreakers, RateLimiters, and Retries. See below for configuration details.</p>
</div>
<div class="paragraph">
<p>Note: If you don&#8217;t register a <code>CircuitBreakerRegistry</code> or <code>RateLimiterRegistry</code> or <code>RetryRegistry</code>, the defaults<br>
will be used.</p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyModule</span> <span class="directive">extends</span> AbstractModule {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure() {
        CircuitBreakerConfig config = CircuitBreakerConfig.custom().build();
        bind(CircuitBreakerRegistry.class).toInstance(CircuitBreakerRegistry.of(config));
        Resilience4jModule module = <span class="keyword">new</span> Resilience4jModule();
        module.configure(c -&gt; {
            c.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, circuitBreakerConfig -&gt;
                circuitBreakerConfig
                        .defaults(<span class="predefined-constant">false</span>)
                        .automaticTransitionFromOpenToHalfOpen(<span class="predefined-constant">false</span>)
                        .failureRateThreshold(<span class="integer">25</span>)
            );
        });
        install(<span class="keyword">new</span> Resilience4jModule());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_handlers"><a class="anchor" href="#_handlers"></a><a class="link" href="#_handlers">4.3.3. Handlers</a></h4>
<div class="paragraph">
<p>You can rate limit an endpoint by defining a <code>RateLimiterHandler</code> for the endpoint.</p>
</div>
<div class="paragraph">
<p>This will only rate limit the <code>/</code> endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ratpack {
    bindings {
        bindInstance(RateLimiterRegistry, RateLimiterRegistry.ofDefaults())
        module(Resilience4jModule)
    }
    handlers {
        get(<span class="keyword">new</span> RateLimiterHandler(registry, <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>))
        get {
            render <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span>
        }
        get(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) {
            render <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will rate limit all endpoints against the same <code>RateLimiter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ratpack {
    bindings {
        bindInstance(RateLimiterRegistry, RateLimiterRegistry.ofDefaults())
        module(Resilience4jModule)
    }
    handlers {
        all(<span class="keyword">new</span> RateLimiterHandler(registry, <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>))
        get {
            render <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span>
        }
        get(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) {
            render <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_promises"><a class="anchor" href="#_promises"></a><a class="link" href="#_promises">4.3.4. Promises</a></h4>
<div class="paragraph">
<p>Ratpack promises provide the means by which an application can become fully non-blocking and asynchronous.<br>
Resilience4j provides transformers that can be applied to Promises. This is ideal when promising a value<br>
that is coming from some sort of I/O source.</p>
</div>
<div class="sect4">
<h5 id="_bulkhead_3"><a class="anchor" href="#_bulkhead_3"></a><a class="link" href="#_bulkhead_3">Bulkhead</a></h5>
<div class="paragraph">
<p>You can easily apply a Bulkhead to any Ratpack Promise, given an existing <code>Bulkhead</code> instance called <code>bulkhead</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Promise&lt;<span class="predefined-type">String</span>&gt; methodWhichReturnsAPromise() {
    <span class="keyword">return</span> backendBConnector.methodWhichReturnsAPromise()
            .transform(BulkheadTransformer.of(bulkhead).recover(t -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_8"><a class="anchor" href="#_circuitbreaker_8"></a><a class="link" href="#_circuitbreaker_8">CircuitBreaker</a></h5>
<div class="paragraph">
<p>You can easily apply a CircuitBreaker to any Ratpack Promise, given an existing <code>CircuitBreaker</code> instance called <code>circuitBreaker</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Promise&lt;<span class="predefined-type">String</span>&gt; methodWhichReturnsAPromise() {
    <span class="keyword">return</span> backendBConnector.methodWhichReturnsAPromise()
            .transform(CircuitBreakerTransformer.of(circuitBreaker).recover(t -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify in-line which exception conditions should be recorded as a failure. In this example when<br>
<code>MyException</code> is thrown, it will be recorded as a circuitbreaker failure. Other exceptions will be ignored by<br>
the <code>circuitBreaker</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Promise&lt;<span class="predefined-type">String</span>&gt; methodWhichReturnsAPromise() {
    <span class="keyword">return</span> backendBConnector.methodWhichReturnsAPromise()
            .transform(
                CircuitBreakerTransformer
                    .of(circuitBreaker)
                    .recover(t -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>)
                    .recordFailurePredicate(e -&gt; e <span class="keyword">instanceof</span> MyException)
            );
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_retry_8"><a class="anchor" href="#_retry_8"></a><a class="link" href="#_retry_8">Retry</a></h5>
<div class="paragraph">
<p>You can easily apply a Retry to any Ratpack Promise, given an existing <code>Retry</code> instance called <code>retry</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Promise&lt;<span class="predefined-type">String</span>&gt; methodWhichReturnsAPromise() {
    <span class="keyword">return</span> backendBConnector.methodWhichReturnsAPromise()
            .transform(RetryTransformer.of(retry).recover(t -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_8"><a class="anchor" href="#_ratelimiter_8"></a><a class="link" href="#_ratelimiter_8">RateLimiter</a></h5>
<div class="paragraph">
<p>You can easily apply a RateLimiter to any Ratpack Promise, given an existing <code>RateLimiter</code> instance called <code>rateLimiter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Promise&lt;<span class="predefined-type">String</span>&gt; methodWhichReturnsAPromise() {
    <span class="keyword">return</span> backendBConnector.methodWhichReturnsAPromise()
            .transform(RateLimiterTransformer.of(rateLimiter).recover(t -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_guice_aop"><a class="anchor" href="#_guice_aop"></a><a class="link" href="#_guice_aop">4.3.5. Guice AOP</a></h4>
<div class="paragraph">
<p>Guice provides method interception capabilities. Here are provided some annotations which support<br>
methods returning types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Promise</p>
</li>
<li>
<p>CompletionStage</p>
</li>
<li>
<p>Object</p>
</li>
<li>
<p>Flux</p>
</li>
<li>
<p>Mono</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_a_note_about_fallback_methods"><a class="anchor" href="#_a_note_about_fallback_methods"></a><a class="link" href="#_a_note_about_fallback_methods">A Note About Fallback Methods</a></h5>
<div class="paragraph">
<p>The <code>fallbackMethod</code> parameter signature for the annotations listed in the next sections must match either:</p>
</div>
<div class="paragraph">
<p>1) The method parameter signature on the annotated method or<br>
2) The method parameter signature with a matching exception type as the last parameter on the annotated method</p>
</div>
<div class="paragraph">
<p>The return value can be a <a href="https://ratpack.io/manual/current/api/ratpack/exec/Promise.html">Promise</a>,<br>
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletionStage.html">CompletionStage</a>,<br>
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a>,<br>
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a>, or any non-reactive object type.<br>
Other reactive types are not supported.</p>
</div>
<div class="paragraph">
<p>If the return value is one of the reactive types listed above, it must match the return value type of the annotated method.</p>
</div>
<div class="sect5">
<h6 id="_examples_6"><a class="anchor" href="#_examples_6"></a><a class="link" href="#_examples_6">Examples</a></h6>
<div class="paragraph">
<p>Fallback for a no-params method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> fallback() {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>
}

OR

<span class="predefined-type">String</span> fallback(<span class="predefined-type">Throwable</span> throwable) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fallback for a method with a single <code>String</code> parameter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> fallback(<span class="predefined-type">String</span> s) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>
}

OR

<span class="predefined-type">String</span> fallback(<span class="predefined-type">String</span> s, <span class="predefined-type">Throwable</span> throwable) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Promise</code> fallback</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Promise&lt;<span class="predefined-type">String</span>&gt; fallback(<span class="predefined-type">String</span> s, <span class="predefined-type">Throwable</span> throwable) {
    Promise.value(<span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CompletionStage</code> fallback</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CompletionStage&lt;<span class="predefined-type">String</span>&gt; fallback(<span class="predefined-type">String</span> s, <span class="predefined-type">Throwable</span> throwable) {
    def future = <span class="keyword">new</span> CompletableFuture&lt;<span class="predefined-type">String</span>&gt;()
    future.complete(<span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">return</span> future
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Flux</code> fallback</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;<span class="predefined-type">String</span>&gt; fallback(<span class="predefined-type">String</span> s, <span class="predefined-type">Throwable</span> throwable) {
    Flux.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Mono</code> fallback</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Mono&lt;<span class="predefined-type">String</span>&gt; fallback(<span class="predefined-type">String</span> s, <span class="predefined-type">Throwable</span> throwable) {
    Mono.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">recovered</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bulkhead_4"><a class="anchor" href="#_bulkhead_4"></a><a class="link" href="#_bulkhead_4">Bulkhead</a></h5>
<div class="paragraph">
<p>The demo shows how to use the <code>Bulkhead</code> annotation to have your Ratpack application limiting number of method calls.<br>
You can either annotate a class in order to protect all public methods or just some specific methods.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bulkhead</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BackendAConnector</span> <span class="directive">implements</span> Connector {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>fallbackMethod</code> is a method in the same class that provides<br>
a fallback value that is returned when the bulkhead identified by <code>name</code> is full or call ends in exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_9"><a class="anchor" href="#_circuitbreaker_9"></a><a class="link" href="#_circuitbreaker_9">CircuitBreaker</a></h5>
<div class="paragraph">
<p>The demo shows how to use the <code>CircuitBreaker</code> annotation to make your Ratpack application more fault tolerant.<br>
You can either annotate a class in order to protect all public methods or just some specific methods.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CircuitBreaker</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BackendAConnector</span> <span class="directive">implements</span> Connector {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>fallbackMethod</code> is a method in the same class that provides<br>
a fallback value that is returned when the circuit breaker identified by <code>name</code> is open.</p>
</div>
</div>
<div class="sect4">
<h5 id="_retry_9"><a class="anchor" href="#_retry_9"></a><a class="link" href="#_retry_9">Retry</a></h5>
<div class="paragraph">
<p>The demo shows how to use the <code>Retry</code> annotation to make your Ratpack application more fault tolerant.<br>
You can either annotate a class in order to protect all public methods or just some specific methods.<br>
For example:<br>
`</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retry</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BackendAConnector</span> <span class="directive">implements</span> Connector {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>fallbackMethod</code> is a method in the same class that provides<br>
a fallback value that is returned when the retry identified by <code>name</code> is has exceeded it&#8217;s max calls.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_9"><a class="anchor" href="#_ratelimiter_9"></a><a class="link" href="#_ratelimiter_9">RateLimiter</a></h5>
<div class="paragraph">
<p>The demo shows how to use the <code>RateLimiter</code> annotation to make your Ratpack application more fault tolerant.<br>
You can either annotate a class in order to protect all public methods or just some specific methods.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RateLimiter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">backendA</span><span class="delimiter">&quot;</span></span>, fallbackMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">fallback</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BackendAConnector</span> <span class="directive">implements</span> Connector {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>fallbackMethod</code> is a method in the same class that provides<br>
a fallback value that is returned when the rate limiter rate limit identified by <code>name</code> is exceeded.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_functional_style"><a class="anchor" href="#_functional_style"></a><a class="link" href="#_functional_style">4.3.6. Functional style</a></h4>
<div class="paragraph">
<p>You can still use a functional programming style for Bulkhead, CircuitBreaker, Retry, and RateLimiter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BusinessBService</span> <span class="directive">implements</span> BusinessService  {

    <span class="directive">public</span> Try&lt;<span class="predefined-type">String</span>&gt; methodWithRecovery() {
        CheckedFunction0&lt;<span class="predefined-type">String</span>&gt; backendFunction = CircuitBreaker.decorateCheckedSupplier(circuitBreaker, () -&gt; backendBConnector.failure());
        <span class="keyword">return</span> Try.of(backendFunction)
                .recover((throwable) -&gt; recovery(throwable));
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> recovery(<span class="predefined-type">Throwable</span> throwable) {
        <span class="comment">// Handle exception and invoke fallback</span>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world from recovery</span><span class="delimiter">&quot;</span></span>;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_bulkheads_circuitbreakers_ratelimiters_and_retries"><a class="anchor" href="#_adding_bulkheads_circuitbreakers_ratelimiters_and_retries"></a><a class="link" href="#_adding_bulkheads_circuitbreakers_ratelimiters_and_retries">4.3.7. Adding Bulkheads, CircuitBreakers, RateLimiters, and Retries</a></h4>
<div class="paragraph">
<p>These can be defined in the module configuration or in an external configuration.<br>
Note that the module only provide default registries, which you can replace by<br>
binding your own.</p>
</div>
<div class="paragraph">
<p>Module configuration example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyModule</span> <span class="directive">extends</span> AbstractModule {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure() {
        Resilience4jModule module = <span class="keyword">new</span> Resilience4jModule();
        module.configure(c -&gt; c
            .bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">test1</span><span class="delimiter">&quot;</span></span>, b -&gt; b
                .defaults(<span class="predefined-constant">true</span>)
            ).bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>, b -&gt; b
                .maxConcurrentCalls(<span class="integer">100</span>)
                .maxWaitTime(<span class="integer">1000</span>)
            ).circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">test1</span><span class="delimiter">&quot;</span></span>, cb -&gt; cb
                .defaults(<span class="predefined-constant">true</span>)
            ).circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>, cb -&gt; cb
                .failureRateThreshold(<span class="integer">50</span>)
                .waitIntervalInMillis(<span class="integer">5000</span>)
                .ringBufferSizeInClosedState(<span class="integer">200</span>)
                .ringBufferSizeInHalfOpenState(<span class="integer">20</span>)
            ).rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">test1</span><span class="delimiter">&quot;</span></span>, cb -&gt; cb
                .defaults(<span class="predefined-constant">true</span>)
            ).rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>, cb -&gt; cb
                .limitForPeriod(<span class="integer">100</span>)
                .limitRefreshPeriodInNanos(<span class="integer">500</span>)
                .timeoutInMillis(<span class="integer">10</span>)
            ).retry(<span class="string"><span class="delimiter">&quot;</span><span class="content">test1</span><span class="delimiter">&quot;</span></span>, cb -&gt; cb
                .defaults(<span class="predefined-constant">true</span>)
            ).retry(<span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>, cb -&gt; cb
                .maxAttempts(<span class="integer">3</span>)
                .waitDurationInMillis(<span class="integer">1000</span>)
            )
        );
        install(module);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>External configuration example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ratpack {
    serverConfig {
        yaml(getClass().classLoader.getResource(<span class="string"><span class="delimiter">'</span><span class="content">application.yml</span><span class="delimiter">'</span></span>))
        require(<span class="string"><span class="delimiter">&quot;</span><span class="content">/resilience4j</span><span class="delimiter">&quot;</span></span>, Resilience4jConfig)
    }
    bindings {
        module(Resilience4jModule)
    }
    handlers {
        get {
            render <span class="string"><span class="delimiter">'</span><span class="content">ok</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>recordFailurePredicate</code> cannot be specified via <code>yaml</code> configuration. Instead specify <code>recordExceptions</code> and <code>ignoreExceptions</code>.<br>
The below example will record everything exception <code>java.io.IOException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">resilience4j</span>:
    <span class="key">bulkheads</span>:
        <span class="key">test1</span>:
            <span class="key">defaults</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">test2</span>:
            <span class="key">maxConcurrentCalls</span>: <span class="string"><span class="content">100</span></span>
            <span class="key">maxWaitTime</span>: <span class="string"><span class="content">1000</span></span>
    <span class="key">circuitBreakers</span>:
        <span class="key">test1</span>:
            <span class="key">defaults</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">test2</span>:
            <span class="key">ringBufferSizeInClosedState</span>: <span class="string"><span class="content">200</span></span>
            <span class="key">ringBufferSizeInHalfOpenState</span>: <span class="string"><span class="content">20</span></span>
            <span class="key">waitInterval</span>: <span class="string"><span class="content">5000</span></span>
            <span class="key">failureRateThreshold</span>: <span class="string"><span class="content">50</span></span>
            <span class="key">recordExceptions</span>: <span class="string"><span class="content">java.lang.Exception</span></span>
            <span class="key">ignoreExceptions</span>: <span class="string"><span class="content">java.io.IOException</span></span>
    <span class="key">rateLimiters</span>:
        <span class="key">test1</span>:
            <span class="key">defaults</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">test2</span>:
            <span class="key">limitForPeriod</span>: <span class="string"><span class="content">100</span></span>
            <span class="key">limitRefreshPeriodInNanos</span>: <span class="string"><span class="content">500</span></span>
            <span class="key">timeoutInMillis</span>: <span class="string"><span class="content">10</span></span>
    <span class="key">retries</span>:
        <span class="key">test1</span>:
            <span class="key">defaults</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">test2</span>:
            <span class="key">maxAttempts</span>: <span class="string"><span class="content">3</span></span>
            <span class="key">waitDurationInMillis</span>: <span class="string"><span class="content">1000</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_metrics"><a class="anchor" href="#_metrics"></a><a class="link" href="#_metrics">4.3.8. Metrics</a></h4>
<div class="paragraph">
<p>Both dropwizard and prometheus metrics can be auto configured and enabled for all registered<br>
bulkhead instances, circuitbreaker instances, ratelimiter instances, and retry instances.</p>
</div>
<div class="paragraph">
<p>For dropwizard metrics to work, add a compile dependency on resilience4j-metrics and<br>
bind a MetricRegistry instance.</p>
</div>
<div class="paragraph">
<p>For prometheus metrics to work, add a compile dependency on resilience4j-prometheus and<br>
bind a CollectorRegistry instance.</p>
</div>
<div class="paragraph">
<p>Enabling Dropwizard Metrics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyModule</span> <span class="directive">extends</span> AbstractModule {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure() {
        bind(MetricRegistry.class);
        Resilience4jModule module = <span class="keyword">new</span> Resilience4jModule();
        module.configure(c -&gt; c.metrics(<span class="predefined-constant">true</span>));
        install(module);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enabling Prometheus Metrics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyModule</span> <span class="directive">extends</span> AbstractModule {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure() {
        bind(CollectorRegistry.class);
        Resilience4jModule module = <span class="keyword">new</span> Resilience4jModule();
        module.configure(c -&gt; c.prometheus(<span class="predefined-constant">true</span>));
        install(module);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_monitoring_3"><a class="anchor" href="#_event_monitoring_3"></a><a class="link" href="#_event_monitoring_3">4.3.9. Event Monitoring</a></h4>
<div class="sect4">
<h5 id="_bulkhead_5"><a class="anchor" href="#_bulkhead_5"></a><a class="link" href="#_bulkhead_5">Bulkhead</a></h5>
<div class="paragraph">
<p>These are the same endpoints as implemented for Bulkhead,<br>
so for detailed documentation please refer to previous sections.</p>
</div>
<div class="paragraph">
<p>List of available endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/bulkhead/events</code></p>
</li>
<li>
<p><code>/bulkhead/stream/events</code></p>
</li>
<li>
<p><code>/bulkhead/events/{bulkheadName}</code></p>
</li>
<li>
<p><code>/bulkhead/stream/events/{bulkheadName}</code></p>
</li>
<li>
<p><code>/bulkhead/events/{bulkheadName}/{eventType}</code></p>
</li>
<li>
<p><code>/bulkhead/stream/events/{bulkheadName}/{eventType}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "bulkheadEvents": [
    {
      "bulkheadName": "backendA",
      "type": "CALL_PERMITTED",
      "creationTime": "2017-05-05T21:29:40.463+03:00[Europe/Uzhgorod]"
    },
    {
      "bulkheadName": "backendA",
      "type": "CALL_REJECTED",
      "creationTime": "2017-05-05T21:29:40.469+03:00[Europe/Uzhgorod]"
    },
    {
      "bulkheadName": "backendA",
      "type": "CALL_FINISHED",
      "creationTime": "2017-05-05T21:29:41.268+03:00[Europe/Uzhgorod]"
    }
  ]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_10"><a class="anchor" href="#_circuitbreaker_10"></a><a class="link" href="#_circuitbreaker_10">CircuitBreaker</a></h5>
<div class="paragraph">
<p>The emitted CircuitBreaker events are stored in a separate circular event consumer buffers. The size of a event consumer buffer can be configured per CircuitBreaker in the application.yml file (eventConsumerBufferSize).<br>
The demo adds a custom Ratpack actuator endpoint which can be used to monitor the emitted events of your CircuitBreakers.<br>
The endpoint <code>/circuitbreaker</code> lists the names of all CircuitBreaker instances.<br>
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "circuitBreakers": [
      "backendA",
      "backendB"
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/circuitbreaker/events</code> lists the latest 100 emitted events of all CircuitBreaker instances.<br>
The endpoint <code>/circuitbreaker/stream/events</code> streams emitted events of all CircuitBreaker instances using Server-Sent Events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:39:17.117+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:39:20.518+01:00[Europe/Berlin]",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendB",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:41:31.159+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendB",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:41:33.526+01:00[Europe/Berlin]",
    "durationInMs": 0
  }
]
}</pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint <code>/circuitbreaker/events/{circuitBreakerName}</code> lists the latest emitted events of a specific CircuitBreaker.<br>
The endpoint <code>/circuitbreaker/stream/events/{circuitBreakerName}</code> streams emitted events using Server-Sent Events.<br>
For example <code>/circuitbreaker/events/backendA</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:39:17.117+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "SUCCESS",
    "creationTime": "2017-01-10T15:39:20.518+01:00[Europe/Berlin]",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "STATE_TRANSITION",
    "creationTime": "2017-01-10T15:39:22.341+01:00[Europe/Berlin]",
    "stateTransition": "CLOSED_TO_OPEN"
  },
  {
    "circuitBreakerName": "backendA",
    "type": "NOT_PERMITTED",
    "creationTime": "2017-01-10T15:39:22.780+01:00[Europe/Berlin]"
  }
]
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can even filter the list of  events.<br>
The endpoint <code>/circuitbreaker/events/{circuitBreakerName}/{eventType}</code> lists the filtered events.<br>
The endpoint <code>/circuitbreaker/stream/events/{circuitBreakerName}/{eventType}</code> streams emitted events using Server-Sent Events.<br>
Event types can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ERROR: A CircuitBreakerEvent which informs that an error has been recorded.</p>
</li>
<li>
<p>IGNORED_ERROR: A CircuitBreakerEvent which informs that an error has been ignored.</p>
</li>
<li>
<p>SUCCESS: A CircuitBreakerEvent which informs that a success has been recorded.</p>
</li>
<li>
<p>NOT_PERMITTED: A CircuitBreakerEvent which informs that a call was not permitted because the CircuitBreaker state is OPEN.</p>
</li>
<li>
<p>STATE_TRANSITION: A CircuitBreakerEvent which informs the state of the CircuitBreaker has been changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example /circuitbreaker/events/backendA/ERROR`:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
"circuitBreakerEvents":[
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:42:59.324+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  },
  {
    "circuitBreakerName": "backendA",
    "type": "ERROR",
    "creationTime": "2017-01-10T15:43:22.802+01:00[Europe/Berlin]",
    "errorMessage": "org.springframework.web.client.HttpServerErrorException: 500 This is a remote exception",
    "durationInMs": 0
  }
]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_10"><a class="anchor" href="#_ratelimiter_10"></a><a class="link" href="#_ratelimiter_10">RateLimiter</a></h5>
<div class="paragraph">
<p>These are the same endpoints as implemented for CircuitBreaker,<br>
so for detailed documentation please refer to previous section.</p>
</div>
<div class="paragraph">
<p>List of available endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/ratelimiter/events</code></p>
</li>
<li>
<p><code>/ratelimiter/stream/events</code></p>
</li>
<li>
<p><code>/ratelimiter/events/{retryName}</code></p>
</li>
<li>
<p><code>/ratelimiter/stream/events/{retryName}</code></p>
</li>
<li>
<p><code>/ratelimiter/events/{retryName}/{eventType}</code></p>
</li>
<li>
<p><code>/ratelimiter/stream/events/{retryName}/{eventType}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "rateLimiterEvents": [
    {
      "rateLimiterName": "backendA",
      "type": "SUCCESSFUL_ACQUIRE",
      "creationTime": "2017-05-05T21:29:40.463+03:00[Europe/Uzhgorod]"
    },
    {
      "rateLimiterName": "backendA",
      "type": "SUCCESSFUL_ACQUIRE",
      "creationTime": "2017-05-05T21:29:40.469+03:00[Europe/Uzhgorod]"
    },
    {
      "rateLimiterName": "backendA",
      "type": "FAILED_ACQUIRE",
      "creationTime": "2017-05-05T21:29:41.268+03:00[Europe/Uzhgorod]"
    }
  ]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_retry_10"><a class="anchor" href="#_retry_10"></a><a class="link" href="#_retry_10">Retry</a></h5>
<div class="paragraph">
<p>These are the same endpoints as implemented for CircuitBreaker,<br>
so for detailed documentation please refer to previous sections.</p>
</div>
<div class="paragraph">
<p>List of available endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/retry/events</code></p>
</li>
<li>
<p><code>/retry/stream/events</code></p>
</li>
<li>
<p><code>/retry/events/{retryName}</code></p>
</li>
<li>
<p><code>/retry/stream/events/{retryName}</code></p>
</li>
<li>
<p><code>/retry/events/{retryName}/{eventType}</code></p>
</li>
<li>
<p><code>/retry/stream/events/{retryName}/{eventType}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retryEvents": [
    {
      "retryName": "backendA",
      "retryEventType": "ERROR",
      "numberOfRetryAttempts":3,
      "retryCreationTime": "2017-05-05T21:29:40.463+03:00[Europe/Uzhgorod]"
    },
    {
      "retryName": "backendA",
      "retryEventType": "ERROR",
      "numberOfRetryAttempts":3,
      "retryCreationTime": "2017-05-05T21:29:40.469+03:00[Europe/Uzhgorod]"
    },
    {
      "retryName": "backendA",
      "retryEventType": "ERROR",
      "numberOfRetryAttempts":3,
      "retryCreationTime": "2017-05-05T21:29:41.268+03:00[Europe/Uzhgorod]"
    }
  ]
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retrofit"><a class="anchor" href="#_retrofit"></a><a class="link" href="#_retrofit">4.4. Retrofit</a></h3>
<div class="paragraph">
<p><a href="https://square.github.io/retrofit/">Retrofit</a> client circuit breaking &amp; rate limiting.</p>
</div>
<div class="sect3">
<h4 id="_circuit_breaking"><a class="anchor" href="#_circuit_breaking"></a><a class="link" href="#_circuit_breaking">4.4.1. Circuit Breaking</a></h4>
<div class="paragraph">
<p>Circuit breaking http client calls is based upon the <code>CircuitBreaker</code> instance provided to a <code>CircuitBreakerCallAdaptor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a CircuitBreaker</span>
<span class="directive">private</span> <span class="directive">final</span> CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Create a retrofit instance with CircuitBreaker call adapter</span>
Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()
                .addCallAdapterFactory(CircuitBreakerCallAdapter.of(circuitBreaker))
                .baseUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span>)
                .build();

<span class="comment">// Get an instance of your service with circuit breaking built in.</span>
RetrofitService service = retrofit.create(RetrofitService.class);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_timeouts"><a class="anchor" href="#_timeouts"></a><a class="link" href="#_timeouts">Timeouts</a></h5>
<div class="paragraph">
<p>To trigger circuit breaking by timeout, the time thresholds should be set on a <code>OkHttpClient</code> instance passed into the<br>
<code>Retrofit.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a CircuitBreaker</span>
<span class="directive">private</span> <span class="directive">final</span> CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);

<span class="directive">final</span> <span class="type">long</span> TIMEOUT = <span class="integer">300</span>; <span class="comment">// ms</span>
OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()
        .connectTimeout(TIMEOUT, <span class="predefined-type">TimeUnit</span>.MILLISECONDS)
        .readTimeout(TIMEOUT, <span class="predefined-type">TimeUnit</span>.MILLISECONDS)
        .writeTimeout(TIMEOUT, <span class="predefined-type">TimeUnit</span>.MILLISECONDS)
        .build();

Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()
        .addCallAdapterFactory(CircuitBreakerCallAdapter.of(circuitBreaker))
        .baseUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span>)
        .client(client)
        .build();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_error_responses"><a class="anchor" href="#_error_responses"></a><a class="link" href="#_error_responses">Error responses</a></h5>
<div class="paragraph">
<p>By default, all exceptions and responses where <code>!Response.isSuccessful()</code> will be recorded as an error in the <code>CircuitBreaker</code>.</p>
</div>
<div class="paragraph">
<p>Customising what is considered a <em>successful</em> response is possible like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()
        .addCallAdapterFactory(CircuitBreakerCallAdapter.of(circuitBreaker, (r) -&gt; r.code() &lt; <span class="integer">500</span>));
        .baseUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span>)
        .build();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rate_limiting"><a class="anchor" href="#_rate_limiting"></a><a class="link" href="#_rate_limiting">4.4.2. Rate Limiting</a></h4>
<div class="paragraph">
<p>Rate limiting of http client calls is based upon the configuration passed to the RateLimiterCallAdaptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RateLimiter rateLimiter = RateLimiter.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);

Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()
        .addCallAdapterFactory(RateLimiterCallAdapter.of(rateLimiter))
        .baseUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span>)
        .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the number of calls are exceeded within the period defined by the RateLimiter, a HTTP 429 response (too many requests) will be returned.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dropwizard_metrics_exporter"><a class="anchor" href="#_dropwizard_metrics_exporter"></a><a class="link" href="#_dropwizard_metrics_exporter">4.5. Dropwizard Metrics exporter</a></h3>
<div class="sect3">
<h4 id="_introduction_6"><a class="anchor" href="#_introduction_6"></a><a class="link" href="#_introduction_6">4.5.1. Introduction</a></h4>
<div class="paragraph">
<p>Integration with <a href="http://metrics.dropwizard.io">Dropwizard Metrics</a>.<br>
With this add-on you can easily add your bulkhead, circuit breaker, rate limiter, retry metrics in your Dropwizard <code>MetricRegistry</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">4.5.2. Usage</a></h4>
<div class="sect4">
<h5 id="_bulkhead_6"><a class="anchor" href="#_bulkhead_6"></a><a class="link" href="#_bulkhead_6">Bulkhead</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> MetricRegistry collectorRegistry = <span class="keyword">new</span> MetricRegistry();

<span class="directive">final</span> BulkheadRegistry bulkheadRegistry = BulkheadRegistry.ofDefaults();
<span class="directive">final</span> Bulkhead foo = bulkheadRegistry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> Bulkhead boo = bulkheadRegistry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// you can register all bulkheads at once</span>
collectorRegistry.registerAll(BulkheadMetrics.ofBulkheadRegistry(bulkheadRegistry));
<span class="comment">// or register them one by one</span>
collectorRegistry.registerAll(BulkheadMetrics.ofBulkhead(foo));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each bulkhead this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>available_concurrent_calls</code> - instantaneous read of the number of currently available concurrent calls <code>[int]</code></p>
</li>
<li>
<p><code>max_allowed_concurrent_calls</code> - maximum number of allowed concurrent calls <code>[int]</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_11"><a class="anchor" href="#_circuitbreaker_11"></a><a class="link" href="#_circuitbreaker_11">CircuitBreaker</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> MetricRegistry collectorRegistry = <span class="keyword">new</span> MetricRegistry();

<span class="directive">final</span> CircuitBreakerRegistry circuitBreakerRegistry = CircuitBreakerRegistry.ofDefaults();
<span class="directive">final</span> CircuitBreaker foo = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> CircuitBreaker boo = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// you can register all circuit breakers at once</span>
collectorRegistry.registerAll(CircuitBreakerMetrics.ofCircuitBreakerRegistry(circuitBreakerRegistry));
<span class="comment">// or register them one by one</span>
collectorRegistry.registerAll(CircuitBreakerMetrics.ofCircuitBreaker(foo));

<span class="comment">// there is some additional useful methods in CircuitBreakerMetrics class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For each circuit breaker this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>state</code> - instantaneous read of the current state where 0-CLOSED, 1-OPEN, 2-HALF-OPEN <code>[int]</code></p>
</li>
<li>
<p><code>successful</code> - current number of successful calls <code>[int]</code></p>
</li>
<li>
<p><code>failed</code> - current number of failed calls <code>[int]</code></p>
</li>
<li>
<p><code>buffered</code> - current number of buffered calls <code>[int]</code></p>
</li>
<li>
<p><code>buffered_max</code> - maximum number of buffered calls <code>[int]</code></p>
</li>
<li>
<p><code>not_permitted</code> - current number of not permitted calls <code>[int]</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_11"><a class="anchor" href="#_ratelimiter_11"></a><a class="link" href="#_ratelimiter_11">RateLimiter</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> MetricRegistry metricRegistry = <span class="keyword">new</span> MetricRegistry();
<span class="directive">final</span> RateLimiterRegistry rateLimiterRegistry = RateLimiterRegistry.ofDefaults();
<span class="directive">final</span> RateLimiter rateLimiter = rateLimiterRegistry.rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">testLimit</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// you can register all rate limiters at once</span>
metricRegistry.registerAll(RateLimiterMetrics.ofRateLimiterRegistry(rateLimiterRegistry));
<span class="comment">// or register them one by one</span>
metricRegistry.registerAll(RateLimiterMetrics.ofRateLimiter(rateLimiter));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each rate limiter this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>available_permissions</code> - current number of available permissions <code>[int]</code></p>
</li>
<li>
<p><code>number_of_waiting_threads</code> - current number of threads waiting for permission <code>[int]</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_retry_11"><a class="anchor" href="#_retry_11"></a><a class="link" href="#_retry_11">Retry</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> MetricRegistry metricRegistry = <span class="keyword">new</span> MetricRegistry();
<span class="directive">final</span> RetryRegistry retryRegistry = RetryRegistry.ofDefaults();
<span class="directive">final</span> Retry retry = retryRegistry.retry(<span class="string"><span class="delimiter">&quot;</span><span class="content">testLimit</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// you can register all rate limiters at once</span>
metricRegistry.registerAll(RetryMetrics.ofRetryRegistry(retryRegistry));
<span class="comment">// or register them one by one</span>
metricRegistry.registerAll(RetryMetrics.ofRetry(retry));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each retry this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>successful_calls_without_retry</code> - the number of successful calls without a retry attempt <code>[long]</code></p>
</li>
<li>
<p><code>successful_calls_with_retry</code> - the number of successful calls after a retry attempt <code>[long]</code></p>
</li>
<li>
<p><code>failed_calls_without_retry</code> - the number of failed calls without a retry attempt <code>[long]</code></p>
</li>
<li>
<p><code>failed_calls_with_retry</code> - the number of failed calls after all retry attempts <code>[long]</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prometheus_metrics_integration"><a class="anchor" href="#_prometheus_metrics_integration"></a><a class="link" href="#_prometheus_metrics_integration">4.6. Prometheus Metrics Integration</a></h3>
<div class="sect3">
<h4 id="_introduction_7"><a class="anchor" href="#_introduction_7"></a><a class="link" href="#_introduction_7">4.6.1. Introduction</a></h4>
<div class="paragraph">
<p>Integration with <a href="https://github.com/prometheus/client_java">Prometheus simple client</a></p>
</div>
<div class="paragraph">
<p>This add-on provides Prometheus collectors for <code>CircuitBreaker</code>, <code>RateLimiter</code> and <code>Bulkhead</code> metrics.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_2"><a class="anchor" href="#_usage_2"></a><a class="link" href="#_usage_2">4.6.2. Usage</a></h4>
<div class="sect4">
<h5 id="_circuitbreaker_12"><a class="anchor" href="#_circuitbreaker_12"></a><a class="link" href="#_circuitbreaker_12">CircuitBreaker</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> CollectorRegistry collectorRegistry = CollectorRegistry.defaultRegistry;

<span class="directive">final</span> CircuitBreakerRegistry circuitBreakerRegistry = CircuitBreakerRegistry.ofDefaults();

<span class="directive">final</span> CircuitBreaker foo = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> CircuitBreaker boo = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Registering metrics in prometeus CollectorRegistry</span>
collectorRegistry.register(CircuitBreakerMetricsCollector.ofCircuitBreakerRegistry(circuitBreakerRegistry));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_12"><a class="anchor" href="#_ratelimiter_12"></a><a class="link" href="#_ratelimiter_12">RateLimiter</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> CollectorRegistry collectorRegistry = CollectorRegistry.defaultRegistry;

<span class="directive">final</span> RateLimiterRegistry rateLimiterRegistry = RateLimiterRegistry.ofDefaults();

<span class="directive">final</span> RateLimiter foo = rateLimiterRegistry.rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> RateLimiter boo = rateLimiterRegistry.rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Registering metrics in prometeus CollectorRegistry</span>
collectorRegistry.register(RateLimiterMetricsCollector.ofRateLimiterRegistry(rateLimiterRegistry));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bulkhead_7"><a class="anchor" href="#_bulkhead_7"></a><a class="link" href="#_bulkhead_7">Bulkhead</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> CollectorRegistry collectorRegistry = CollectorRegistry.defaultRegistry;

<span class="directive">final</span> BulkheadRegistry bulkheadRegistry = BulkheadRegistry.ofDefaults();

<span class="directive">final</span> Bulkhead foo = bulkheadRegistry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> Bulkhead boo = bulkheadRegistry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Registering metrics in prometeus CollectorRegistry</span>
collectorRegistry.register(BulkheadMetricsCollector.ofBulkheadRegistry(rateLimiterRegistry));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_micrometer_metrics_exporter"><a class="anchor" href="#_micrometer_metrics_exporter"></a><a class="link" href="#_micrometer_metrics_exporter">4.7. Micrometer Metrics exporter</a></h3>
<div class="sect3">
<h4 id="_introduction_8"><a class="anchor" href="#_introduction_8"></a><a class="link" href="#_introduction_8">4.7.1. Introduction</a></h4>
<div class="paragraph">
<p>Integration with <a href="http://micrometer.io/">Micrometer</a>.<br>
With this add-on you can easily add your bulkhead, circuit breaker, rate limiter, retry metrics in Micrometer <code>MeterRegistry</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_3"><a class="anchor" href="#_usage_3"></a><a class="link" href="#_usage_3">4.7.2. Usage</a></h4>
<div class="sect4">
<h5 id="_bulkhead_8"><a class="anchor" href="#_bulkhead_8"></a><a class="link" href="#_bulkhead_8">Bulkhead</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> BulkheadRegistry bulkheadRegistry = BulkheadRegistry.ofDefaults();
<span class="directive">final</span> Bulkhead foo = bulkheadRegistry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> Bulkhead boo = bulkheadRegistry.bulkhead(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Register all bulkheads at once</span>
TaggedBulkheadMetrics.ofBulkheadRegistry(bulkheadRegistry).bindTo(meterRegistry);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each bulkhead this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resilience4j_bulkhead_available_concurrent_calls{name="name of bulkhead"}</code> - number of available concurrent calls</p>
</li>
<li>
<p><code>resilience4j_bulkhead_max_allowed_concurrent_calls{name="name of bulkhead"}</code> - maximum number of allowed concurrent calls</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_circuitbreaker_13"><a class="anchor" href="#_circuitbreaker_13"></a><a class="link" href="#_circuitbreaker_13">CircuitBreaker</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> CircuitBreakerRegistry circuitBreakerRegistry = CircuitBreakerRegistry.ofDefaults();
<span class="directive">final</span> CircuitBreaker foo = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> CircuitBreaker boo = circuitBreakerRegistry.circuitBreaker(<span class="string"><span class="delimiter">&quot;</span><span class="content">boo</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Register all circuit breakers at once</span>
TaggedCircuitBreakerMetrics.ofCircuitBreakerRegistry(circuitBreakerRegistry).bindTo(meterRegistry);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each circuit breaker this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resilience4j_circuitbreaker_state{name="name of circuitbreaker"}</code> - the state of the circuit breaker where 0-CLOSED, 1-OPEN, 2-HALF-OPEN</p>
</li>
<li>
<p><code>resilience4j_circuitbreaker_calls{name="name of circuitbreaker", kind="one of the values below"}</code> - the number of calls of a certain kind</p>
<div class="ulist">
<ul>
<li>
<p><code>successful</code> - indicates successful calls</p>
</li>
<li>
<p><code>failed</code> - indicates failed calls</p>
</li>
<li>
<p><code>not_permitted</code> - indicates not permitted calls</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>resilience4j_circuitbreaker_buffered_calls{name="name of circuitbreaker"}</code> - the number of buffered calls</p>
</li>
<li>
<p><code>resilience4j_circuitbreaker_max_buffered_calls{name="name of circuitbreaker"}</code> - the maximum number of buffered calls</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ratelimiter_13"><a class="anchor" href="#_ratelimiter_13"></a><a class="link" href="#_ratelimiter_13">RateLimiter</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> RateLimiterRegistry rateLimiterRegistry = RateLimiterRegistry.ofDefaults();
<span class="directive">final</span> RateLimiter rateLimiter = rateLimiterRegistry.rateLimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">testLimit</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Register rate limiters at once</span>
TaggedRateLimiterMetrics.ofRateLimiterRegistry(rateLimiterRegistry).bindTo(meterRegistry);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each rate limiter this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resilience4j_ratelimiter_available_permissions{name="name of ratelimiter"}</code> - the number of available permissions</p>
</li>
<li>
<p><code>resilience4j_ratelimiter_waiting_threads{name="name of ratelimiter"}</code> - the number of threads waiting for permission</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_retry_12"><a class="anchor" href="#_retry_12"></a><a class="link" href="#_retry_12">Retry</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> MetricRegistry metricRegistry = <span class="keyword">new</span> MetricRegistry();
<span class="directive">final</span> RetryRegistry retryRegistry = RetryRegistry.ofDefaults();
<span class="directive">final</span> Retry retry = retryRegistry.retry(<span class="string"><span class="delimiter">&quot;</span><span class="content">testLimit</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Register all retries at once</span>
TaggedRetryMetrics.ofRetryRegistry(retryRegistry).bindTo(meterRegistry);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each retry this registry will export:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resilience4j_retry_calls{name="retry name", kind="one of the values below"}</code> - the number of calls of a certain kind</p>
<div class="ulist">
<ul>
<li>
<p><code>successful_without_retry</code> - indicates successful calls without retry</p>
</li>
<li>
<p><code>successful_with_retry</code> - indicates successful calls with retry</p>
</li>
<li>
<p><code>failed_without_retry</code> - indicates failed calls without retry</p>
</li>
<li>
<p><code>failed_with_retry</code> - indicates failed calls with retry</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note the same set of metrics is exposed for async retry, metric name is <code>resilience4j_async_retry_calls</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_details"><a class="anchor" href="#_implementation_details"></a><a class="link" href="#_implementation_details">5. Implementation details</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_circuitbreaker_14"><a class="anchor" href="#_circuitbreaker_14"></a><a class="link" href="#_circuitbreaker_14">5.1. CircuitBreaker</a></h3>
<div class="paragraph">
<p>The CircuitBreaker is implemented via a finite state machine with three normal states: <code>CLOSED</code>, <code>OPEN</code> and <code>HALF_OPEN</code> and two special states <code>DISABLED</code> and <code>FORCED_OPEN</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/state_machine.jpg" alt="state machine">
</div>
</div>
<div class="paragraph">
<p>The CircuitBreaker does not know anything about the backend&#8217;s state by itself, but uses the information provided by the decorators via <code>CircuitBreaker::onSuccess</code> and <code>CircuitBreaker::onError</code>. See example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> &lt;T&gt; Supplier&lt;T&gt; decorateSupplier(CircuitBreaker circuitBreaker, Supplier&lt;T&gt; supplier){
    <span class="keyword">return</span> () -&gt; {
        circuitBreaker.acquirePermission();
        <span class="type">long</span> start = <span class="predefined-type">System</span>.nanoTime();
        <span class="keyword">try</span> {
            T returnValue = supplier.get();
            <span class="type">long</span> durationInNanos = <span class="predefined-type">System</span>.nanoTime() - start;
            circuitBreaker.onSuccess(durationInNanos);
            <span class="keyword">return</span> returnValue;
        } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> throwable) {
            <span class="type">long</span> durationInNanos = <span class="predefined-type">System</span>.nanoTime() - start;
            circuitBreaker.onError(durationInNanos, throwable);
            <span class="keyword">throw</span> throwable;
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The state of the CircuitBreaker changes from <code>CLOSED</code> to <code>OPEN</code> when the failure rate is above a (configurable) threshold.<br>
Then, all access to the backend is blocked for a (configurable) time duration. <code>CircuitBreaker::acquirePermission()</code> throws a <code>CircuitBreakerOpenException</code>, if the CircuitBreaker is <code>OPEN</code>.</p>
</div>
<div class="paragraph">
<p>The CircuitBreaker uses a Ring Bit Buffer in the <code>CLOSED</code> state to store the success or failure statuses of the calls. A successful call is stored as a <code>0</code> bit and a failed call is stored as a <code>1</code> bit. The Ring Bit Buffer has a (configurable) fixed-size. The Ring Bit Buffer uses internally a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/BitSet.html">BitSet</a> like data structure to store the bits which is saving memory compared to a boolean array. The BitSet uses a long[] array to store the bits. That means the BitSet only needs an array of 16 long (64-bit) values to store the status of 1024 calls.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ring_buffer.jpg" alt="Ring Bit Buffer">
</div>
</div>
<div class="paragraph">
<p>The Ring Bit Buffer must be full, before the failure rate can be calculated.<br>
For example, if the size of the Ring Buffer is 10, then at least 10 calls must evaluated, before the failure rate can be calculated. If only 9 calls have been evaluated the CircuitBreaker will not trip open even if all 9 calls have failed.</p>
</div>
<div class="paragraph">
<p>After the time duration has elapsed, the CircuitBreaker state changes from <code>OPEN</code> to <code>HALF_OPEN</code> and allows calls to see if the backend is still unavailable or has become available again. The CircuitBreaker uses another (configurable) Ring Bit Buffer to evaluate the failure rate in the <code>HALF_OPEN</code> state. If the failure rate is above the configured threshold, the state changes back to <code>OPEN</code>. If the failure rate is below or equal to the threshold, the state changes back to <code>CLOSED</code>.<br>
<code>CircuitBreaker::onError</code> checks if the exception should be recorded as a failure or should be ignored. You can configure a custom <code>Predicate</code> which decides whether an exception should be recorded as a failure. The default Predicate records all exceptions as a failure.</p>
</div>
<div class="paragraph">
<p>The CircuitBreaker supports resetting to its original state, losing all the metrics and resetting its Ring Bit Buffer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);
circuitBreaker.reset();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CircuitBreaker supports two more special states, <code>DISABLED</code> (always allow access) and <code>FORCED_OPEN</code> (always deny access). In these two states no CircuitBreakerEvents (apart from the state transition) are generated, and no metrics are recorded. The only way to exit from those states are to trigger a state transition or to reset the CircuitBreaker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);
circuitBreaker.transitionToDisabledState();
<span class="comment">// circuitBreaker.onFailure(...) won't trigger a state change</span>
circuitBreaker.transitionToClosedState(); <span class="comment">// will transition to CLOSED state and re-enable normal behaviour, keeping metrics</span>
circuitBreaker.transitionToForcedOpenState();
<span class="comment">// circuitBreaker.onSuccess(...) won't trigger a state change</span>
circuitBreaker.reset(); <span class="comment">//  will transition to CLOSED state and re-enable normal behaviour, losing metrics</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The CircuitBreaker publishes a stream of CircuitBreakerEvents to any Subscriber/Consumer who subscribes. An event can be a state transition or a recorded error. This library uses RxJava to to provide this functionality. If you want to consume events, you have to subscribe to the event stream. This library provides a consumer <code>CircuitBreakerEventConsumer</code> which can be used to store events in a circular buffer with a fixed capacity. You can use RxJava to filter certain events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults(<span class="string"><span class="delimiter">&quot;</span><span class="content">testName</span><span class="delimiter">&quot;</span></span>);
CircuitBreakerEventConsumer ringBuffer = <span class="keyword">new</span> CircuitBreakerEventConsumer(<span class="integer">10</span>);
circuitBreaker.getEventStream()
        .filter(event -&gt; event.getEventType() == <span class="predefined-type">Type</span>.ERROR)
        .subscribe(ringBuffer);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ratelimiter_14"><a class="anchor" href="#_ratelimiter_14"></a><a class="link" href="#_ratelimiter_14">5.2. RateLimiter</a></h3>
<div class="paragraph">
<p>Conceptually <code>RateLimiter</code> splits all nanoseconds from the start of epoch into cycles.<br>
Each cycle has duration configured by <code>RateLimiterConfig.limitRefreshPeriod</code>.<br>
By contract on start of each cycle <code>RateLimiter</code> should set <code>activePermissions</code> to <code>RateLimiterConfig.limitForPeriod</code>.<br>
For the <code>RateLimiter</code> callers it is really looks so, but for example <code>AtomicRateLimiter</code> implementation has<br>
some optimisations under the hood that will skip this refresh if <code>RateLimiter</code> is not used actively.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rate_limiter.png" alt="Rate Limiter">
</div>
</div>
<div class="paragraph">
<p>The default implementation of <code>RateLimiter</code> is <code>AtomicRateLimiter</code> it manages state via <code>AtomicReference</code>.<br>
<code>AtomicRateLimiter.State</code> is completely immutable and has the folowing fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>activeCycle</code> - cycle number that was used by the last call.</p>
</li>
<li>
<p><code>activePermissions</code> - count of available permissions after the last call.<br>
Can be negative if some permissions where reserved.</p>
</li>
<li>
<p><code>nanosToWait</code> - count of nanoseconds to wait for permission for the last call.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>AtomicRateLimiter</code> is also very fast on i7-5557U processor and with x64 Java-1.8.0_112<br>
it takes only <code>1431 [ns]</code> to acquire permission.<br>
So you can easily restrict not only network calls but your local in-memory operations, too.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license"><a class="anchor" href="#_license"></a><a class="link" href="#_license">6. License</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright 2017 Robert Winkler, Bohdan Storozhuk, Oleksandr Goldobin, Christopher Pilsworth and Dan Maas</p>
</div>
<div class="paragraph">
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://www.apache.org/licenses/LICENSE-2.0</pre>
</div>
</div>
<div class="paragraph">
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.15.0-SNAPSHOT<br>
Last updated 2019-05-18 07:29:17 UTC
</div>
</div>
</body>
</html>